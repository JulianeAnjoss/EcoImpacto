<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EcoImpacto - Mudan√ßas Clim√°ticas e Seguran√ßa Alimentar</title>
<link rel="icon" href="./assets/favicon.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>


/* Estilos para telas menores (celulares) */
@media (max-width: 768px) {
  body {
    font-size: 16px;
    padding: 20px;
  }

  .container {
    flex-direction: column;
    padding: 10px;
  }

  nav ul {
    flex-direction: column;
    align-items: center;
  }

  img {
    max-width: 100%;
    height: auto;
  }
}
        .hero-gradient { background: linear-gradient(135deg, #059669 0%, #10b981 100%); }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
        .section-padding { padding: 5rem 0; }
        .nav-link { position: relative; }
        .nav-link::after { content: ''; position: absolute; width: 0; height: 2px; bottom: -5px; left: 0; background-color: white; transition: width 0.3s ease; }
        .nav-link:hover::after { width: 100%; }
        .pulse-alert { animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        #map { height: 500px; width: 100%; border-radius: 10px; }
        .leaflet-popup-content { font-family: sans-serif; max-width: 300px; }
        .ranking-item { transition: all 0.3s ease; }
        .ranking-item:hover { background-color: #f0f9ff; }
        .food-security-chart { max-height: 300px; }
        .connection-arrow { 
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .connection-arrow::after {
            content: '‚Üí';
            font-size: 2rem;
            color: #6b7280;
            margin: 0 1rem;
        }
        @media (max-width: 768px) {
            .connection-arrow::after {
                content: '‚Üì';
                margin: 1rem 0;
            }
        }
    </style>
</head>
<body class="bg-white text-gray-800 font-sans antialiased">

    <!-- Navbar Atualizada -->
    <header class="bg-green-700 text-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 py-3 flex flex-col md:flex-row justify-between items-center">
            <div class="flex items-center mb-3 md:mb-0">
                <i class="fas fa-seedling text-xl mr-2"></i>
                <h1 class="text-2xl font-bold">EcoImpacto</h1>
            </div>
            <nav class="flex flex-wrap justify-center gap-4 md:gap-6">
                <a href="#home" class="nav-link text-sm md:text-base"><i class="fas fa-home mr-1"></i> In√≠cio</a>
                <a href="#introducao" class="nav-link text-sm md:text-base"><i class="fas fa-info-circle mr-1"></i> Entenda</a>
                <a href="#dashboard-duplo" class="nav-link text-sm md:text-base"><i class="fas fa-chart-bar mr-1"></i> Impactos</a>
                <a href="#seguranca-alimentar" class="nav-link text-sm md:text-base"><i class="fas fa-apple-alt mr-1"></i> Alimenta√ß√£o</a>
                <a href="#relatos" class="nav-link text-sm md:text-base"><i class="fas fa-edit mr-1"></i> Relatar</a>
            </nav>
        </div>
    </header>

    <!-- Hero Section Atualizada -->
    <section id="home" class="relative bg-green-800 text-white">
        <div class="absolute inset-0 bg-black opacity-40 z-0"></div>
        <div class="relative z-10 section-padding">
            <div class="max-w-5xl mx-auto px-4 text-center">
                <h2 class="text-4xl md:text-5xl font-extrabold mb-6 leading-tight">
                   EcoImpacto - Plataforma de Diagn√≥stico Clim√°tico e Seguran√ßa Alimentar
                </h2>
                <p class="text-lg md:text-xl mb-8 max-w-3xl mx-auto">
                    Entenda como as mudan√ßas clim√°ticas afetam diretamente o alimento na sua mesa e junte-se √† comunidade para construir solu√ß√µes.
                </p>
                <div class="flex flex-col sm:flex-row justify-center gap-4">
                    <a href="#introducao" class="bg-white text-green-700 px-6 py-3 rounded-full font-semibold shadow-lg hover:bg-green-50 transition flex items-center justify-center">
                        <i class="fas fa-play-circle mr-2"></i> Come√ßar a Entender
                    </a>
                    <a href="#relatos" class="bg-green-600 text-white px-6 py-3 border border-white rounded-full font-semibold hover:bg-green-700 transition flex items-center justify-center">
                        <i class="fas fa-edit mr-2"></i> Relatar Minha Realidade
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- Alertas em Destaque -->
    <section id="alertas" class="bg-red-50 py-4 border-b-4 border-red-500">
        <div class="max-w-6xl mx-auto px-4">
            <div class="flex items-center justify-center">
                <i class="fas fa-exclamation-triangle text-red-600 text-xl mr-3"></i>
                <p class="text-red-700 font-semibold text-center">
                    <span id="alertaDestaque">Carregando alertas da sua regi√£o...</span>
                </p>
            </div>
        </div>
    </section>

    <!-- NOVA SE√á√ÉO: Introdu√ß√£o Educativa -->
    <section id="introducao" class="section-padding bg-white">
        <div class="max-w-6xl mx-auto px-4">
            <h3 class="text-3xl font-bold text-gray-800 mb-2 text-center">Por Que Clima e Alimenta√ß√£o Est√£o Conectados?</h3>
            <p class="text-gray-600 text-center mb-12 max-w-3xl mx-auto">Entenda a cadeia que liga eventos clim√°ticos extremos ao alimento na sua mesa</p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-12">
                <div class="text-center">
                    <div class="bg-blue-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-temperature-high text-blue-600 text-2xl"></i>
                    </div>
                    <h4 class="font-bold text-gray-800 mb-2">Eventos Clim√°ticos</h4>
                    <p class="text-gray-600 text-sm">Secas, inunda√ß√µes e temperaturas extremas se intensificam</p>
                </div>
                
                <div class="text-center connection-arrow">
                    <div class="bg-orange-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-tractor text-orange-600 text-2xl"></i>
                    </div>
                    <h4 class="font-bold text-gray-800 mb-2">Impacto na Produ√ß√£o</h4>
                    <p class="text-gray-600 text-sm">Safras s√£o perdidas e a produtividade cai</p>
                </div>
                
                <div class="text-center connection-arrow">
                    <div class="bg-red-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-chart-line text-red-600 text-2xl"></i>
                    </div>
                    <h4 class="font-bold text-gray-800 mb-2">Pre√ßos em Alta</h4>
                    <p class="text-gray-600 text-sm">Escassez leva ao aumento dos pre√ßos dos alimentos</p>
                </div>
                
                <div class="text-center">
                    <div class="bg-green-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-utensils text-green-600 text-2xl"></i>
                    </div>
                    <h4 class="font-bold text-gray-800 mb-2">Sua Mesa</h4>
                    <p class="text-gray-600 text-sm">O acesso a alimentos nutritivos fica comprometido</p>
                </div>
            </div>

            <div class="bg-green-50 rounded-2xl p-8 text-center">
                <h4 class="text-2xl font-bold text-green-800 mb-4">üìà Dados que Preocupam</h4>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div class="bg-white p-4 rounded-lg shadow-sm">
                        <div class="text-3xl font-bold text-red-600 mb-2">+28%</div>
                        <p class="text-gray-700">Aumento no pre√ßo da cesta b√°sica no √∫ltimo ano</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-sm">
                        <div class="text-3xl font-bold text-orange-600 mb-2">33M</div>
                        <p class="text-gray-700">Brasileiros em situa√ß√£o de inseguran√ßa alimentar</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-sm">
                        <div class="text-3xl font-bold text-blue-600 mb-2">-15%</div>
                        <p class="text-gray-700">Queda na produ√ß√£o agr√≠cola por eventos clim√°ticos</p>
                    </div>
                </div>
                <a href="#dashboard-duplo" class="inline-block bg-green-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-green-700 transition">
                    <i class="fas fa-chart-bar mr-2"></i> Ver Impactos na Minha Regi√£o
                </a>
            </div>
        </div>
    </section>

    <!-- NOVA SE√á√ÉO: Dashboard Duplo Clima √ó Alimenta√ß√£o -->
    <section id="dashboard-duplo" class="section-padding bg-gray-50">
        <div class="max-w-7xl mx-auto px-4">
            <h3 class="text-3xl font-bold text-gray-800 mb-2 text-center">Impactos em Tempo Real: Clima √ó Alimenta√ß√£o</h3>
            <p class="text-gray-600 text-center mb-10">Veja como as condi√ß√µes clim√°ticas atuais afetam diretamente sua seguran√ßa alimentar</p>
            
            <div class="grid grid-cols-1 xl:grid-cols-2 gap-8 mb-8">
                <!-- Dashboard do Clima -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center mb-6">
                        <div class="bg-blue-100 p-3 rounded-full mr-4">
                            <i class="fas fa-cloud-sun text-blue-600 text-2xl"></i>
                        </div>
                        <div>
                            <h4 class="text-xl font-bold">Condi√ß√µes Clim√°ticas Atuais</h4>
                            <p class="text-gray-600">Como o clima est√° afetando a produ√ß√£o</p>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <p class="text-sm text-gray-600">Temperatura</p>
                            <p class="text-2xl font-bold text-blue-700" id="tempAtual">--¬∞C</p>
                            <p class="text-xs text-gray-500" id="tempStatus">Carregando...</p>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg">
                            <p class="text-sm text-gray-600">Umidade</p>
                            <p class="text-2xl font-bold text-green-700" id="umidadeAtual">--%</p>
                            <p class="text-xs text-gray-500" id="umidadeStatus">Carregando...</p>
                        </div>
                    </div>
                    
                    <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded-r-lg mb-4">
                        <h5 class="font-semibold text-yellow-800 mb-2">‚ö†Ô∏è Alertas de Produ√ß√£o</h5>
                        <p class="text-yellow-700 text-sm" id="alertaProducao">Analisando impactos na agricultura...</p>
                    </div>
                    
                    <div class="text-center">
                        <a href="#dados" class="text-blue-600 hover:text-blue-800 font-semibold text-sm">
                            <i class="fas fa-arrow-right mr-1"></i> Ver an√°lise clim√°tica completa
                        </a>
                    </div>
                </div>

                <!-- Dashboard da Alimenta√ß√£o -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center mb-6">
                        <div class="bg-green-100 p-3 rounded-full mr-4">
                            <i class="fas fa-apple-alt text-green-600 text-2xl"></i>
                        </div>
                        <div>
                            <h4 class="text-xl font-bold">Situa√ß√£o Alimentar</h4>
                            <p class="text-gray-600">Disponibilidade e acesso aos alimentos</p>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div class="bg-orange-50 p-4 rounded-lg">
                            <p class="text-sm text-gray-600">Pre√ßo do Arroz</p>
                            <p class="text-2xl font-bold text-orange-700" id="precoArroz">R$ --</p>
                            <p class="text-xs text-gray-500" id="statusArroz">Carregando...</p>
                        </div>
                        <div class="bg-red-50 p-4 rounded-lg">
                            <p class="text-sm text-gray-600">Pre√ßo do Feij√£o</p>
                            <p class="text-2xl font-bold text-red-700" id="precoFeijao">R$ --</p>
                            <p class="text-xs text-gray-500" id="statusFeijao">Carregando...</p>
                        </div>
                    </div>
                    
                    <div class="bg-green-50 border-l-4 border-green-500 p-4 rounded-r-lg mb-4">
                        <h5 class="font-semibold text-green-800 mb-2">üìä Seguran√ßa Alimentar</h5>
                        <p class="text-green-700 text-sm" id="statusSegurancaAlimentar">Avaliando acesso √† alimenta√ß√£o...</p>
                    </div>
                    
                    <div class="text-center">
                        <a href="#seguranca-alimentar" class="text-green-600 hover:text-green-800 font-semibold text-sm">
                            <i class="fas fa-arrow-right mr-1"></i> Ver dashboard alimentar completo
                        </a>
                    </div>
                </div>
            </div>

            <!-- Conex√£o Visual -->
            <div class="bg-white rounded-xl shadow-lg p-6 text-center">
                <h4 class="text-lg font-bold text-gray-800 mb-4">üîó Conex√£o Clima ‚Üí Alimenta√ß√£o</h4>
                <div class="bg-purple-50 p-4 rounded-lg">
                    <p class="text-purple-800 font-semibold" id="conexaoClimaAlimentacao">
                        <i class="fas fa-sync-alt mr-2"></i>
                        Analisando como o clima atual impacta os pre√ßos e disponibilidade de alimentos...
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- Se√ß√£o: Seguran√ßa Alimentar -->
    <section id="seguranca-alimentar" class="section-padding bg-white">
        <div class="max-w-7xl mx-auto px-4">
            <h3 class="text-3xl font-bold text-gray-800 mb-2 text-center">Seguran√ßa Alimentar e Mudan√ßas Clim√°ticas</h3>
            <p class="text-gray-600 text-center mb-10">Monitoramento dos impactos clim√°ticos na produ√ß√£o, disponibilidade e acesso a alimentos</p>
            
            <!-- Indicadores de Seguran√ßa Alimentar -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
                <div class="bg-white p-6 rounded-xl shadow-md card-hover border-l-4 border-green-500">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-sm text-gray-500">Disponibilidade de Alimentos</p>
                            <p class="text-2xl font-bold text-green-600" id="disponibilidadeAlimentos">--</p>
                        </div>
                        <i class="fas fa-utensils text-green-500 text-xl"></i>
                    </div>
                    <p class="text-xs text-gray-600 mt-2" id="statusDisponibilidade">Avaliando estoques regionais</p>
                </div>
                
                <div class="bg-white p-6 rounded-xl shadow-md card-hover border-l-4 border-orange-500">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-sm text-gray-500">Acesso a Alimentos</p>
                            <p class="text-2xl font-bold text-orange-600" id="acessoAlimentos">--</p>
                        </div>
                        <i class="fas fa-shopping-basket text-orange-500 text-xl"></i>
                    </div>
                    <p class="text-xs text-gray-600 mt-2" id="statusAcesso">Verificando acessibilidade</p>
                </div>
                
                <div class="bg-white p-6 rounded-xl shadow-md card-hover border-l-4 border-yellow-500">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-sm text-gray-500">Pre√ßos dos Alimentos</p>
                            <p class="text-2xl font-bold text-yellow-600" id="precosAlimentos">--</p>
                        </div>
                        <i class="fas fa-chart-line text-yellow-500 text-xl"></i>
                    </div>
                    <p class="text-xs text-gray-600 mt-2" id="tendenciaPrecos">Monitorando varia√ß√µes</p>
                </div>
                
                <div class="bg-white p-6 rounded-xl shadow-md card-hover border-l-4 border-blue-500">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-sm text-gray-500">Produ√ß√£o Agr√≠cola</p>
                            <p class="text-2xl font-bold text-blue-600" id="producaoAgricola">--</p>
                        </div>
                        <i class="fas fa-tractor text-blue-500 text-xl"></i>
                    </div>
                    <p class="text-xs text-gray-600 mt-2" id="statusProducao">Avaliando safras</p>
                </div>
            </div>
            

            <!-- Gr√°fico de Seguran√ßa Alimentar -->
            <div class="bg-white rounded-xl shadow-md p-6 mb-8">
                <h4 class="text-xl font-bold mb-4 flex items-center">
                    <i class="fas fa-chart-bar text-green-600 mr-2"></i>
                    Indicadores de Seguran√ßa Alimentar - Tend√™ncias
                </h4>
                <div class="food-security-chart">
                    <canvas id="foodSecurityChart"></canvas>
                </div>
                <p class="text-sm text-gray-600 mt-3">
                    <i class="fas fa-info-circle text-blue-500 mr-1"></i>
                    Dados baseados em relat√≥rios da FAO, CONAB e IBGE - Atualizado mensalmente
                </p>
            </div>

            <!-- Not√≠cias sobre Seguran√ßa Alimentar -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h4 class="text-xl font-bold mb-6 flex items-center">
                    <i class="fas fa-newspaper text-purple-600 mr-2"></i>
                    Not√≠cias Recentes - Seguran√ßa Alimentar
                </h4>
                <div id="noticiasSegurancaAlimentar" class="space-y-4">
                    <div class="text-center py-8">
                        <i class="fas fa-spinner fa-spin text-3xl text-gray-400 mb-3"></i>
                        <p class="text-gray-500">Carregando not√≠cias sobre seguran√ßa alimentar...</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Dashboard Estadual -->
<section id="dashboard-estadual" class="section-padding bg-gray-50">
    <div class="max-w-7xl mx-auto px-4">
        <h3 class="text-3xl font-bold text-gray-800 mb-2 text-center">Dashboard por Estado</h3>
        <p class="text-gray-600 text-center mb-10">An√°lise em tempo real baseada nos relatos da comunidade e not√≠cias recentes</p>
        
        <!-- Filtros e Sele√ß√£o de Estado -->
        <div class="bg-white rounded-xl shadow-md p-6 mb-8">
            <div class="flex flex-col md:flex-row justify-between items-center mb-6">
                <h4 class="text-xl font-bold flex items-center mb-4 md:mb-0">
                    <i class="fas fa-map-marked-alt text-blue-600 mr-2"></i>
                    An√°lise por Estado
                </h4>
                <div class="flex gap-4">
                    <select id="selecionarEstado" class="border rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" onchange="filtrarPorEstado()">
                        <option value="">Todos os Estados</option>
                        <option value="AC">Acre</option>
                        <option value="AL">Alagoas</option>
                        <option value="AP">Amap√°</option>
                        <option value="AM">Amazonas</option>
                        <option value="BA">Bahia</option>
                        <option value="CE">Cear√°</option>
                        <option value="DF">Distrito Federal</option>
                        <option value="ES">Esp√≠rito Santo</option>
                        <option value="GO">Goi√°s</option>
                        <option value="MA">Maranh√£o</option>
                        <option value="MT">Mato Grosso</option>
                        <option value="MS">Mato Grosso do Sul</option>
                        <option value="MG">Minas Gerais</option>
                        <option value="PA">Par√°</option>
                        <option value="PB">Para√≠ba</option>
                        <option value="PR">Paran√°</option>
                        <option value="PE">Pernambuco</option>
                        <option value="PI">Piau√≠</option>
                        <option value="RJ">Rio de Janeiro</option>
                        <option value="RN">Rio Grande do Norte</option>
                        <option value="RS">Rio Grande do Sul</option>
                        <option value="RO">Rond√¥nia</option>
                        <option value="RR">Roraima</option>
                        <option value="SC">Santa Catarina</option>
                        <option value="SP">S√£o Paulo</option>
                        <option value="SE">Sergipe</option>
                        <option value="TO">Tocantins</option>
                    </select>
                </div>
            </div>

            <!-- Cards de Vis√£o Geral Estadual -->
            <div id="visaoGeralEstadual" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <!-- Os cards ser√£o preenchidos via JavaScript -->
            </div>

            <!-- Tabela de Cidades com Maiores Problemas -->
            <div class="bg-white rounded-xl shadow-md p-6 mb-8">
                <h4 class="text-xl font-bold mb-4 flex items-center">
                    <i class="fas fa-list-ol text-purple-500 mr-2"></i>
                    Cidades com Mais Relatos
                </h4>
                <div id="tabelaCidades" class="overflow-x-auto">
                    <table class="min-w-full bg-white">
                        <thead>
                            <tr class="bg-gray-100">
                                <th class="py-3 px-4 text-left">Cidade</th>
                                <th class="py-3 px-4 text-left">Problema Principal</th>
                                <th class="py-3 px-4 text-left">Gravidade</th>
                                <th class="py-3 px-4 text-left">Relatos</th>
                                <th class="py-3 px-4 text-left">√öltimo Relato</th>
                            </tr>
                        </thead>
                        <tbody id="dadosTabelaCidades">
                            <!-- Dados ser√£o preenchidos via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Gr√°fico de Distribui√ß√£o de Problemas -->
            <div class="bg-white rounded-xl shadow-md p-6 mb-8">
                <h4 class="text-xl font-bold mb-4 flex items-center">
                    <i class="fas fa-chart-pie text-green-600 mr-2"></i>
                    Distribui√ß√£o de Problemas no Estado
                </h4>
                <div class="h-64">
                    <canvas id="graficoProblemasEstado"></canvas>
                </div>
            </div>
        </div>

        <!-- Not√≠cias Relacionadas ao Estado -->
        <div id="noticiasEstado" class="bg-white rounded-xl shadow-md p-6">
            <h4 class="text-xl font-bold mb-6 flex items-center">
                <i class="fas fa-newspaper text-orange-500 mr-2"></i>
                Not√≠cias Recentes da Regi√£o
            </h4>
            <div id="conteudoNoticiasEstado" class="space-y-4">
                <div class="text-center py-8 text-gray-500">
                    <i class="fas fa-newspaper text-3xl mb-3"></i>
                    <p>Selecione um estado para ver not√≠cias relacionadas</p>
                </div>
            </div>
        </div>
    </div>
</section>
    <!-- Dashboard Principal -->
    <section id="dados" class="section-padding bg-white">
        <div class="max-w-7xl mx-auto px-4">
            <h3 class="text-3xl font-bold text-gray-800 mb-2 text-center">Monitoramento da Sua Regi√£o</h3>
            <p class="text-gray-600 text-center mb-10">Dados em tempo real e an√°lise de impactos na sa√∫de e seguran√ßa alimentar</p>
            
            <!-- Cards de M√©tricas Locais -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
                <div class="bg-white p-6 rounded-xl shadow-md card-hover">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-sm text-gray-500">Risco Atual</p>
                            <p class="text-2xl font-bold text-red-600" id="riscoAtual">--</p>
                        </div>
                        <i class="fas fa-exclamation-triangle text-red-500 text-xl"></i>
                    </div>
                    <p class="text-xs text-gray-600 mt-2" id="localAtual">Sua localiza√ß√£o</p>
                </div>
                
                <div class="bg-white p-6 rounded-xl shadow-md card-hover">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-sm text-gray-500">Seguran√ßa Alimentar</p>
                            <p class="text-2xl font-bold text-orange-600" id="segurancaAlimentar">--</p>
                        </div>
                        <i class="fas fa-apple-alt text-orange-500 text-xl"></i>
                    </div>
                    <p class="text-xs text-gray-600 mt-2" id="impactoAlimentar">Impacto atual</p>
                </div>
                
                <div class="bg-white p-6 rounded-xl shadow-md card-hover">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-sm text-gray-500">Sa√∫de P√∫blica</p>
                            <p class="text-2xl font-bold text-yellow-600" id="saudePublica">--</p>
                        </div>
                        <i class="fas fa-heartbeat text-yellow-500 text-xl"></i>
                    </div>
                    <p class="text-xs text-gray-600 mt-2" id="impactoSaude">Risco √† sa√∫de</p>
                </div>
                
                <div class="bg-white p-6 rounded-xl shadow-md card-hover">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-sm text-gray-500">Relatos Ativos</p>
                            <p class="text-2xl font-bold text-blue-600" id="relatosAtivos">0</p>
                        </div>
                        <i class="fas fa-bullhorn text-blue-500 text-xl"></i>
                    </div>
                    <p class="text-xs text-gray-600 mt-2" id="comunidadeAtiva">Sua comunidade</p>
                </div>
            </div>

            <!-- Mapa Interativo com Dados Reais -->
            <div class="bg-white p-6 rounded-xl shadow-md mb-8">
                <div class="flex justify-between items-center mb-4">
                    <h4 class="text-xl font-bold flex items-center">
                        <i class="fas fa-map-marked-alt text-blue-600 mr-2"></i>
                        Mapa de Riscos - Dados Oficiais INMET
                    </h4>
                    <button onclick="centralizarNoUsuario()" class="bg-blue-500 text-white px-4 py-2 rounded-lg text-sm hover:bg-blue-600 transition flex items-center">
                        <i class="fas fa-location-arrow mr-2"></i> Minha Localiza√ß√£o
                    </button>
                </div>
                <div id="map"></div>
                <p class="text-sm text-gray-600 mt-3">
                    <i class="fas fa-info-circle text-blue-500 mr-1"></i>
                    Dados oficiais do INMET e CEMADEN - Atualizado em tempo real
                </p>
            </div>

            <!-- Diagn√≥stico de Impacto em Tempo Real -->
            <div class="bg-white rounded-xl shadow-md p-6 mb-8">
                <h4 class="text-xl font-bold mb-4 flex items-center">
                    <i class="fas fa-stethoscope text-green-600 mr-2"></i>
                    Diagn√≥stico de Impacto na Sua √Årea
                </h4>
                <div id="diagnosticoImpacto" class="space-y-4">
                    <div class="text-center py-8">
                        <i class="fas fa-spinner fa-spin text-3xl text-gray-400 mb-3"></i>
                        <p class="text-gray-500">Analisando impactos na sa√∫de e seguran√ßa alimentar...</p>
                    </div>
                </div>
            </div>

            <!-- An√°lise de Sa√∫de e Seguran√ßa Alimentar -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <!-- Impactos na Sa√∫de -->
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h4 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-heartbeat text-purple-500 mr-2"></i>
                        Impactos na Sa√∫de Humana
                    </h4>
                    <div id="health-impacts" class="space-y-3">
                        <div class="text-center py-4">
                            <i class="fas fa-spinner fa-spin text-gray-400 mr-2"></i>
                            Analisando riscos √† sa√∫de...
                        </div>
                    </div>
                </div>

                <!-- A√ß√µes de Preven√ß√£o -->
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h4 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-shield-alt text-orange-500 mr-2"></i>
                        A√ß√µes de Preven√ß√£o Imediata
                    </h4>
                    <div id="prevention-actions" class="space-y-3">
                        <div class="text-center py-4">
                            <i class="fas fa-spinner fa-spin text-gray-400 mr-2"></i>
                            Gerando recomenda√ß√µes...
                        </div>
                    </div>
                </div>
            </div>

            <!-- Not√≠cias Oficiais em Tempo Real -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h4 class="text-xl font-bold mb-6 flex items-center">
                    <i class="fas fa-newspaper text-purple-600 mr-2"></i>
                    Alertas e Not√≠cias Oficiais
                </h4>
                <div id="noticiasContainer" class="space-y-4">
                    <div class="text-center py-8">
                        <i class="fas fa-spinner fa-spin text-3xl text-gray-400 mb-3"></i>
                        <p class="text-gray-500">Carregando alertas oficiais...</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Sistema de Relatos Comunit√°rios -->
  <section id="relatos" class="section-padding bg-gray-50">
    <div class="max-w-4xl mx-auto px-4">
        <h3 class="text-3xl font-bold text-gray-800 mb-6 text-center">Relatos Comunit√°rios</h3>
        
        <div class="bg-green-50 rounded-xl p-6 mb-8">
            <h4 class="text-xl font-semibold mb-4 flex items-center">
                <i class="fas fa-plus-circle text-green-600 mr-2"></i>
                Novo Relato da Comunidade
            </h4>
            <form id="formRelato" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Tipo de Problema</label>
                        <select id="tipoProblema" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" required>
                            <option value="">Selecione...</option>
                            <option value="seca">Altas temperaturas</option>
                            <option value="seca">Seca/Estiagem</option>
                            <option value="inundacao">Inunda√ß√£o/Alagamento</option>
                            <option value="queimada">Queimada/Fogo</option>
                            <option value="desmatamento">Desmatamento</option>
                            <option value="inseguranca_alimentar">Falta de Alimentos</option>
                            <option value="aumento_precos">Aumento de Pre√ßos</option>
                            <option value="perda_safra">Perda de Safra</option>
                            <option value="agua_contaminada">√Ågua Contaminada</option>
                            <option value="doencas">Surtos de Doen√ßas</option>
                            <option value="agricultura">Perda Agr√≠cola</option>
                            <option value="outro">Outro</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Gravidade</label>
                        <select id="gravidade" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" required>
                            <option value="">Selecione...</option>
                            <option value="baixa">Baixa</option>
                            <option value="media">M√©dia</option>
                            <option value="alta">Alta</option>
                            <option value="critica">Cr√≠tica (Emerg√™ncia)</option>
                        </select>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Bairro</label>
                        <input type="text" id="bairroRelato" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" required placeholder="Seu bairro">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Cidade</label>
                        <input type="text" id="cidadeRelato" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Estado</label>
                        <select id="estadoRelato" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" required>
                            <option value="">Selecione...</option>
                            <option value="AC">Acre</option>
                            <option value="AL">Alagoas</option>
                            <option value="AP">Amap√°</option>
                            <option value="AM">Amazonas</option>
                            <option value="BA">Bahia</option>
                            <option value="CE">Cear√°</option>
                            <option value="DF">Distrito Federal</option>
                            <option value="ES">Esp√≠rito Santo</option>
                            <option value="GO">Goi√°s</option>
                            <option value="MA">Maranh√£o</option>
                            <option value="MT">Mato Grosso</option>
                            <option value="MS">Mato Grosso do Sul</option>
                            <option value="MG">Minas Gerais</option>
                            <option value="PA">Par√°</option>
                            <option value="PB">Para√≠ba</option>
                            <option value="PR">Paran√°</option>
                            <option value="PE">Pernambuco</option>
                            <option value="PI">Piau√≠</option>
                            <option value="RJ">Rio de Janeiro</option>
                            <option value="RN">Rio Grande do Norte</option>
                            <option value="RS">Rio Grande do Sul</option>
                            <option value="RO">Rond√¥nia</option>
                            <option value="RR">Roraima</option>
                            <option value="SC">Santa Catarina</option>
                            <option value="SP">S√£o Paulo</option>
                            <option value="SE">Sergipe</option>
                            <option value="TO">Tocantins</option>
                        </select>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Descri√ß√£o Detalhada</label>
                    <textarea id="descricaoRelato" rows="3" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="Descreva o problema em detalhes: como est√° afetando a sa√∫de, alimenta√ß√£o ou seguran√ßa da comunidade..." required></textarea>
                </div>
                
                <button type="submit" class="w-full bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700 transition flex items-center justify-center">
                    <i class="fas fa-paper-plane mr-2"></i> Enviar Relato para a Comunidade
                </button>
            </form>
        </div>

        <!-- Lista de Relatos Recentes com Sistema de Pagina√ß√£o -->
        <div class="bg-white rounded-xl shadow-md p-6">
            <div class="flex justify-between items-center mb-4">
                <h4 class="text-xl font-bold flex items-center">
                    <i class="fas fa-list-alt text-blue-600 mr-2"></i>
                    Relatos Recentes da Comunidade
                </h4>
                <div class="flex gap-2">
                    <select id="filtroEstadoRelatos" class="border rounded-lg px-3 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" onchange="filtrarRelatos()">
                        <option value="">Todos os estados</option>
                        <option value="AC">Acre</option>
                        <option value="AL">Alagoas</option>
                        <option value="AP">Amap√°</option>
                        <option value="AM">Amazonas</option>
                        <option value="BA">Bahia</option>
                        <option value="CE">Cear√°</option>
                        <option value="DF">Distrito Federal</option>
                        <option value="ES">Esp√≠rito Santo</option>
                        <option value="GO">Goi√°s</option>
                        <option value="MA">Maranh√£o</option>
                        <option value="MT">Mato Grosso</option>
                        <option value="MS">Mato Grosso do Sul</option>
                        <option value="MG">Minas Gerais</option>
                        <option value="PA">Par√°</option>
                        <option value="PB">Para√≠ba</option>
                        <option value="PR">Paran√°</option>
                        <option value="PE">Pernambuco</option>
                        <option value="PI">Piau√≠</option>
                        <option value="RJ">Rio de Janeiro</option>
                        <option value="RN">Rio Grande do Norte</option>
                        <option value="RS">Rio Grande do Sul</option>
                        <option value="RO">Rond√¥nia</option>
                        <option value="RR">Roraima</option>
                        <option value="SC">Santa Catarina</option>
                        <option value="SP">S√£o Paulo</option>
                        <option value="SE">Sergipe</option>
                        <option value="TO">Tocantins</option>
                    </select>
                </div>
            </div>
            
            <div id="listaRelatos" class="space-y-4 mb-6">
                <!-- Relatos ser√£o carregados aqui -->
            </div>
            
            <!-- Controles de Pagina√ß√£o -->
            <div id="controlesPaginacao" class="flex justify-between items-center pt-4 border-t border-gray-200">
                <div class="text-sm text-gray-600">
                    Mostrando <span id="relatosMostrados">0</span> de <span id="totalRelatos">0</span> relatos
                </div>
                <div class="flex gap-2">
                    <button id="btnVerMais" onclick="carregarMaisRelatos()" class="bg-blue-500 text-white px-4 py-2 rounded-lg text-sm hover:bg-blue-600 transition flex items-center">
                        <i class="fas fa-chevron-down mr-2"></i> Ver Mais 10
                    </button>
                    <button id="btnFecharTudo" onclick="fecharTodosRelatos()" class="bg-gray-500 text-white px-4 py-2 rounded-lg text-sm hover:bg-gray-600 transition flex items-center hidden">
                        <i class="fas fa-times mr-2"></i> Fechar Tudo
                    </button>
                </div>
            </div>
        </div>
    </div>
</section>
    <!-- Ranking de √Åreas Cr√≠ticas -->
    <section id="ranking" class="section-padding bg-green-50">
        <div class="max-w-6xl mx-auto px-4">
            <h3 class="text-3xl font-bold text-gray-800 mb-2 text-center">Ranking de √Åreas Cr√≠ticas</h3>
            <p class="text-gray-600 text-center mb-10">Locais com maior concentra√ß√£o de problemas relatados pela comunidade</p>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Ranking por Bairro -->
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h4 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-map-marker-alt text-red-500 mr-2"></i>
                        Top Bairros com Problemas
                    </h4>
                    <div id="rankingBairros" class="space-y-3">
                        <!-- Ranking ser√° gerado aqui -->
                    </div>
                </div>
                
                <!-- Ranking por Tipo de Problema -->
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h4 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-exclamation-triangle text-orange-500 mr-2"></i>
                        Problemas Mais Reportados
                    </h4>
                    <div id="rankingProblemas" class="space-y-3">
                        <!-- Ranking ser√° gerado aqui -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Bot de Diagn√≥stico com IA -->
    <section id="bot" class="section-padding bg-white">
        <div class="max-w-4xl mx-auto px-4">
            <h3 class="text-3xl font-bold text-gray-800 mb-6 text-center">Diagn√≥stico com Intelig√™ncia Artificial</h3>
            
            <div class="bg-green-50 rounded-xl shadow-md p-6 mb-8">
                <div class="flex items-center mb-6">
                    <div class="bg-green-100 p-3 rounded-full mr-4">
                        <i class="fas fa-robot text-green-600 text-2xl"></i>
                    </div>
                    <div>
                        <h4 class="text-xl font-bold">EcoIA - Assistente de Diagn√≥stico</h4>
                        <p class="text-gray-600">Analiso dados clim√°ticos e comunit√°rios para prever impactos na sua sa√∫de e seguran√ßa alimentar</p>
                    </div>
                </div>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Selecione sua √Årea para An√°lise Detalhada:</label>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <button onclick="gerarDiagnostico('bairro')" class="bg-blue-500 text-white py-3 rounded-lg font-semibold hover:bg-blue-600 transition flex items-center justify-center">
                            <i class="fas fa-home mr-2"></i> Meu Bairro
                        </button>
                        <button onclick="gerarDiagnostico('cidade')" class="bg-green-500 text-white py-3 rounded-lg font-semibold hover:bg-green-600 transition flex items-center justify-center">
                            <i class="fas fa-city mr-2"></i> Minha Cidade
                        </button>
                        <button onclick="gerarDiagnostico('regiao')" class="bg-purple-500 text-white py-3 rounded-lg font-semibold hover:bg-purple-600 transition flex items-center justify-center">
                            <i class="fas fa-map mr-2"></i> Minha Regi√£o
                        </button>
                    </div>
                </div>
                
                <div class="mt-6 p-4 bg-white rounded-lg border border-green-200">
                    <div id="diagnosticoResultado">
                        <p class="text-gray-600 text-center">Selecione uma √°rea acima para gerar o diagn√≥stico completo</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- NOVA SE√á√ÉO: Chamada para A√ß√£o Final -->
    <section id="chamada-acao" class="section-padding bg-green-800 text-white">
        <div class="max-w-4xl mx-auto px-4 text-center">
            <h3 class="text-3xl font-bold mb-6">Juntos Podemos Transformar Realidades</h3>
            <p class="text-xl mb-8 text-green-100">
                Sua participa√ß√£o √© essencial para mapear os impactos das mudan√ßas clim√°ticas na seguran√ßa alimentar da sua comunidade
            </p>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-green-700 p-6 rounded-lg">
                    <i class="fas fa-bullhorn text-3xl mb-4"></i>
                    <h4 class="font-bold text-lg mb-2">Relate</h4>
                    <p class="text-green-200">Compartilhe situa√ß√µes da sua regi√£o</p>
                </div>
                
                <div class="bg-green-700 p-6 rounded-lg">
                    <i class="fas fa-chart-line text-3xl mb-4"></i>
                    <h4 class="font-bold text-lg mb-2">Monitore</h4>
                    <p class="text-green-200">Acompanhe dados em tempo real</p>
                </div>
                
                <div class="bg-green-700 p-6 rounded-lg">
                    <i class="fas fa-hands-helping text-3xl mb-4"></i>
                    <h4 class="font-bold text-lg mb-2">Aja</h4>
                    <p class="text-green-200">Participe das solu√ß√µes comunit√°rias</p>
                </div>
            </div>
            
            <div class="flex flex-col sm:flex-row justify-center gap-4">
                <a href="#relatos" class="bg-white text-green-700 px-8 py-4 rounded-full font-bold text-lg hover:bg-green-50 transition flex items-center justify-center">
                    <i class="fas fa-edit mr-2"></i> Fazer Meu Primeiro Relato
                </a>
                <a href="#dashboard-estadual" class="bg-green-600 text-white px-8 py-4 border border-white rounded-full font-bold text-lg hover:bg-green-700 transition flex items-center justify-center">
                    <i class="fas fa-search mr-2"></i> Explorar Meu Estado
                </a>
            </div>
        </div>
    </section>

    <!-- Rodap√© -->
    <footer class="bg-gray-800 text-white py-10">
        <div class="max-w-6xl mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div>
                    <div class="flex items-center mb-4">
                        <i class="fas fa-seedling text-xl mr-2 text-green-400"></i>
                        <h3 class="text-xl font-bold">EcoImpacto</h3>
                    </div>
                    <p class="text-gray-400">Sistema inteligente de monitoramento clim√°tico e seguran√ßa alimentar comunit√°ria.</p>
                </div>
                
                <div>
                    <h4 class="text-lg font-semibold mb-4">Links R√°pidos</h4>
                    <ul class="space-y-2">
                        <li><a href="#home" class="text-gray-400 hover:text-white transition">In√≠cio</a></li>
                        <li><a href="#introducao" class="text-gray-400 hover:text-white transition">Entenda a Conex√£o</a></li>
                        <li><a href="#dashboard-duplo" class="text-gray-400 hover:text-white transition">Impactos em Tempo Real</a></li>
                        <li><a href="#seguranca-alimentar" class="text-gray-400 hover:text-white transition">Seguran√ßa Alimentar</a></li>
                        <li><a href="#relatos" class="text-gray-400 hover:text-white transition">Relatar Problema</a></li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="text-lg font-semibold mb-4">Fontes de Dados</h4>
                    <ul class="space-y-2 text-gray-400">
                        <li class="flex items-center">
                            <i class="fas fa-satellite mr-2"></i>
                            <span>INMET - Dados Clim√°ticos</span>
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-apple-alt mr-2"></i>
                            <span>FAO - Seguran√ßa Alimentar</span>
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-newspaper mr-2"></i>
                            <span>Not√≠cias em Tempo Real</span>
                        </li>
                    </ul>
                </div>
            </div>
            
            <div class="border-t border-gray-700 mt-8 pt-6 text-center text-gray-400">
                <p>¬© 2025 EcoImpacto. Todos os direitos reservados.</p>
            </div>
        </div>
    </footer>

    <script>
        // Vari√°veis globais
        let mapa;
        let todosRelatos = [];
        let userLocation = null;
        let userBairro = null;
        let userCidade = null;
        const OPENWEATHER_API_KEY = 'f5388f8c9779d967c66b9a183cbc3eb4';
        let foodSecurityChart = null;
        let graficoProblemasEstado = null;

        // Inicializa√ß√£o do sistema
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        async function initializeApp() {
            try {
                await getUserLocation();
                await initializeMap();
                await loadAllData();
                
                // Inicializar dashboard estadual
                carregarDashboardEstadual();
                
                // Atualizar dados a cada 10 minutos
                setInterval(loadAllData, 600000);
            } catch (error) {
                console.error('Error initializing app:', error);
                showError('Erro ao inicializar o sistema. Recarregue a p√°gina.');
            }
        }

        function getUserLocation() {
            return new Promise((resolve, reject) => {
                if (!navigator.geolocation) {
                    reject(new Error('Geolocaliza√ß√£o n√£o suportada'));
                    return;
                }

                navigator.geolocation.getCurrentPosition(
                    async (position) => {
                        userLocation = {
                            lat: position.coords.latitude,
                            lon: position.coords.longitude
                        };
                        await updateLocationDisplay();
                        resolve();
                    },
                    (error) => {
                        console.error('Geolocation error:', error);
                        // Fallback para S√£o Paulo
                        userLocation = { lat: -23.5505, lon: -46.6333 };
                        updateLocationDisplay();
                        resolve();
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 600000
                    }
                );
            });
        }

        async function updateLocationDisplay() {
            try {
                const response = await fetch(
                    `https://nominatim.openstreetmap.org/reverse?format=json&lat=${userLocation.lat}&lon=${userLocation.lon}`
                );
                const data = await response.json();
                
                if (data.address) {
                    userBairro = data.address.suburb || data.address.neighbourhood || data.address.quarter || "Bairro Desconhecido";
                    userCidade = data.address.city || data.address.town || data.address.municipality || "Cidade Desconhecida";
                    
                    document.getElementById('localAtual').textContent = `${userBairro}, ${userCidade}`;
                    document.getElementById('comunidadeAtiva').textContent = `${userBairro}`;
                }
            } catch (error) {
                document.getElementById('localAtual').textContent = 'Localiza√ß√£o detectada';
            }
        }

        function initializeMap() {
            mapa = L.map('map').setView([userLocation.lat, userLocation.lon], 13);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(mapa);

            // Adicionar marcador do usu√°rio
            L.marker([userLocation.lat, userLocation.lon])
                .addTo(mapa)
                .bindPopup('<b>Sua Localiza√ß√£o</b><br>Monitoramento ativo')
                .openPopup();

            // Carregar dados reais de alertas
            loadRealAlertsData();
        }

        function centralizarNoUsuario() {
            if (userLocation && mapa) {
                mapa.setView([userLocation.lat, userLocation.lon], 13);
                mostrarNotificacao('Mapa centralizado na sua localiza√ß√£o', 'success');
            }
        }

        async function loadAllData() {
            try {
                await loadClimateData();
                await loadFoodSecurityData();
                await loadFoodSecurityNews();
                await loadHealthImpacts();
                await loadPreventionActions();
                await loadOfficialNews();
                carregarRelatos();
                atualizarRankings();
                gerarDiagnosticoImpacto();
            } catch (error) {
                console.error('Error loading data:', error);
                showError('Erro ao carregar dados. Tentando novamente...');
            }
        }

        async function loadClimateData() {
            try {
                const response = await fetch(
                    `https://api.openweathermap.org/data/2.5/weather?lat=${userLocation.lat}&lon=${userLocation.lon}&appid=${OPENWEATHER_API_KEY}&units=metric&lang=pt_br`
                );
                const data = await response.json();

                if (data.cod === 200) {
                    updateClimateData(data);
                    updateClimateAlerts(data);
                }
            } catch (error) {
                document.getElementById('climate-data').innerHTML = 
                    '<div class="text-red-500">Erro ao carregar dados clim√°ticos</div>';
            }
        }

        function updateClimateData(data) {
            const temp = Math.round(data.main.temp);
            const humidity = data.main.humidity;
            
            let risco, seguranca, saude, alerta;
            
            if (temp > 35 || humidity < 20) {
                risco = 'ALTO';
                seguranca = 'CR√çTICA';
                saude = 'ALTO';
                alerta = 'üö® ALERTA: Temperaturas extremas e baixa umidade - Risco para sa√∫de e produ√ß√£o de alimentos';
            } else if (temp > 30 || humidity > 85) {
                risco = 'M√âDIO';
                seguranca = 'ALERTA';
                saude = 'MODERADO';
                alerta = '‚ö†Ô∏è ATEN√á√ÉO: Condi√ß√µes clim√°ticas podem afetar seguran√ßa alimentar e sa√∫de p√∫blica';
            } else {
                risco = 'BAIXO';
                seguranca = 'EST√ÅVEL';
                saude = 'BAIXO';
                alerta = '‚úÖ Condi√ß√µes clim√°ticas est√°veis na regi√£o';
            }
            
            document.getElementById('riscoAtual').textContent = risco;
            document.getElementById('segurancaAlimentar').textContent = seguranca;
            document.getElementById('saudePublica').textContent = saude;
            document.getElementById('impactoAlimentar').textContent = `Temp: ${temp}¬∞C, Umidade: ${humidity}%`;
            document.getElementById('impactoSaude').textContent = `Condi√ß√µes: ${data.weather[0].description}`;
            document.getElementById('alertaDestaque').textContent = alerta;
            
            // ATUALIZA√á√ÉO: Chamar a nova fun√ß√£o do dashboard duplo
            updateDashboardDuplo(data);
        }

        function updateClimateAlerts(weatherData) {
            const temp = weatherData.main.temp;
            const humidity = weatherData.main.humidity;
            const alerts = [];

            if (temp > 35) {
                alerts.push('Temperatura extrema: risco de desidrata√ß√£o e estresse t√©rmico');
            }
            if (temp < 5) {
                alerts.push('Temperatura muito baixa: risco de hipotermia');
            }
            if (humidity < 30) {
                alerts.push('Umidade muito baixa: risco de problemas respirat√≥rios');
            }
            if (humidity > 85) {
                alerts.push('Umidade muito alta: risco de prolifera√ß√£o de fungos e bact√©rias');
            }

            if (alerts.length > 0) {
                document.getElementById('alertaDestaque').textContent = alerts.join(' | ');
                document.getElementById('alertas').className = 'bg-red-50 py-4 border-b-4 border-red-500 pulse-alert';
            }
        }

        function loadRealAlertsData() {
            // Simular dados reais de alertas por bairro (em produ√ß√£o, integrar com API do INMET)
            const alertas = [
                { lat: userLocation.lat + 0.01, lon: userLocation.lon + 0.01, tipo: 'Alagamento', risco: 'Alto', bairro: 'Centro' },
                { lat: userLocation.lat - 0.02, lon: userLocation.lon - 0.01, tipo: 'Seca', risco: 'M√©dio', bairro: 'Vila Nova' },
                { lat: userLocation.lat + 0.015, lon: userLocation.lon - 0.02, tipo: 'Queimada', risco: 'Cr√≠tico', bairro: 'Jardim Paulista' }
            ];

            alertas.forEach(alerta => {
                const cor = alerta.risco === 'Cr√≠tico' ? 'red' : alerta.risco === 'Alto' ? 'orange' : 'yellow';
                const raio = alerta.risco === 'Cr√≠tico' ? 1000 : alerta.risco === 'Alto' ? 800 : 600;
                
                L.circle([alerta.lat, alerta.lon], {
                    color: cor,
                    fillColor: cor,
                    fillOpacity: 0.4,
                    radius: raio
                }).addTo(mapa).bindPopup(`
                    <div class="font-sans">
                        <h3 class="font-bold" style="color: ${cor}">${alerta.bairro}</h3>
                        <p><strong>Alerta:</strong> ${alerta.tipo}</p>
                        <p><strong>Risco:</strong> ${alerta.risco}</p>
                        <p><strong>Fonte:</strong> INMET</p>
                        <p><strong>Atualizado:</strong> ${new Date().toLocaleTimeString('pt-BR')}</p>
                    </div>
                `);
            });
        }

        // ========== NOVAS FUN√á√ïES PARA O DASHBOARD DUPLO ==========
        function updateDashboardDuplo(weatherData) {
            // Atualizar dados do clima
            document.getElementById('tempAtual').textContent = `${Math.round(weatherData.main.temp)}¬∞C`;
            document.getElementById('umidadeAtual').textContent = `${weatherData.main.humidity}%`;
            
            // Status da temperatura
            const temp = weatherData.main.temp;
            if (temp > 30) {
                document.getElementById('tempStatus').textContent = 'Acima do normal';
                document.getElementById('tempStatus').className = 'text-xs text-red-500';
            } else if (temp < 15) {
                document.getElementById('tempStatus').textContent = 'Abaixo do normal';
                document.getElementById('tempStatus').className = 'text-xs text-blue-500';
            } else {
                document.getElementById('tempStatus').textContent = 'Normal para a √©poca';
                document.getElementById('tempStatus').className = 'text-xs text-green-500';
            }
            
            // Status da umidade
            const humidity = weatherData.main.humidity;
            if (humidity < 30) {
                document.getElementById('umidadeStatus').textContent = 'Muito baixa';
                document.getElementById('umidadeStatus').className = 'text-xs text-orange-500';
            } else if (humidity > 80) {
                document.getElementById('umidadeStatus').textContent = 'Muito alta';
                document.getElementById('umidadeStatus').className = 'text-xs text-blue-500';
            } else {
                document.getElementById('umidadeStatus').textContent = 'Ideal';
                document.getElementById('umidadeStatus').className = 'text-xs text-green-500';
            }
            
            // An√°lise de impacto na produ√ß√£o
            let alertaProducao = '';
            
            if (temp > 35) {
                alertaProducao = 'Calor extremo - risco para hortifr√∫ti e gr√£os';
            } else if (temp < 10) {
                alertaProducao = 'Frio intenso - pode afetar cultivos sens√≠veis';
            } else if (humidity < 30) {
                alertaProducao = 'Umidade baixa - estresse h√≠drico nas planta√ß√µes';
            } else if (humidity > 85) {
                alertaProducao = 'Umidade alta - risco de doen√ßas f√∫ngicas';
            } else {
                alertaProducao = 'Condi√ß√µes favor√°veis para a produ√ß√£o agr√≠cola';
            }
            
            document.getElementById('alertaProducao').textContent = alertaProducao;
            
            // Simular dados de pre√ßos (em produ√ß√£o, integrar com APIs)
            const precoBaseArroz = 5.90;
            const precoBaseFeijao = 8.50;
            
            // Ajustar pre√ßos baseados nas condi√ß√µes clim√°ticas
            let fatorAjuste = 1.0;
            if (temp > 32 || humidity < 35) {
                fatorAjuste = 1.15; // +15% em condi√ß√µes adversas
            } else if (temp < 12 || humidity > 85) {
                fatorAjuste = 1.08; // +8% em condi√ß√µes moderadas
            }
            
            const precoArroz = (precoBaseArroz * fatorAjuste).toFixed(2);
            const precoFeijao = (precoBaseFeijao * fatorAjuste).toFixed(2);
            
            document.getElementById('precoArroz').textContent = `R$ ${precoArroz}`;
            document.getElementById('precoFeijao').textContent = `R$ ${precoFeijao}`;
            
            // Status dos pre√ßos
            const variacao = ((fatorAjuste - 1) * 100).toFixed(0);
            if (fatorAjuste > 1) {
                document.getElementById('statusArroz').textContent = `+${variacao}% este m√™s`;
                document.getElementById('statusArroz').className = 'text-xs text-red-500';
                document.getElementById('statusFeijao').textContent = `+${variacao}% este m√™s`;
                document.getElementById('statusFeijao').className = 'text-xs text-red-500';
            } else {
                document.getElementById('statusArroz').textContent = 'Est√°vel';
                document.getElementById('statusArroz').className = 'text-xs text-green-500';
                document.getElementById('statusFeijao').textContent = 'Est√°vel';
                document.getElementById('statusFeijao').className = 'text-xs text-green-500';
            }
            
            // Conex√£o clima-alimenta√ß√£o
            let conexao = '';
            if (temp > 32 || humidity < 40) {
                conexao = 'üå°Ô∏è Condi√ß√µes clim√°ticas atuais podem pressionar os pre√ßos dos alimentos nas pr√≥ximas semanas';
            } else if (temp < 12 || humidity > 80) {
                conexao = 'üåßÔ∏è Condi√ß√µes atuais podem afetar log√≠stica e disponibilidade de produtos frescos';
            } else {
                conexao = '‚úÖ Condi√ß√µes clim√°ticas est√°veis - tend√™ncia de pre√ßos sob controle';
            }
            
            document.getElementById('conexaoClimaAlimentacao').innerHTML = `<i class="fas fa-sync-alt mr-2"></i> ${conexao}`;
            
            // Status geral seguran√ßa alimentar
            let statusGeral = '';
            if (parseFloat(precoArroz) > 7.0 || parseFloat(precoFeijao) > 10.0) {
                statusGeral = '‚ö†Ô∏è Pre√ßos elevados podem comprometer o acesso a alimentos b√°sicos';
            } else if (temp > 35 || humidity < 25) {
                statusGeral = 'üå°Ô∏è Condi√ß√µes extremas exigem aten√ß√£o √† conserva√ß√£o de alimentos';
            } else {
                statusGeral = '‚úÖ Condi√ß√µes favor√°veis para seguran√ßa alimentar local';
            }
            
            document.getElementById('statusSegurancaAlimentar').textContent = statusGeral;
        }

        // ========== FUN√á√ïES PARA SEGURAN√áA ALIMENTAR ==========
        async function loadFoodSecurityData() {
            try {
                // Simular dados de seguran√ßa alimentar (em produ√ß√£o, integrar com APIs da FAO, CONAB, etc.)
                const foodData = generateFoodSecurityData();
                
                document.getElementById('disponibilidadeAlimentos').textContent = foodData.disponibilidade.status;
                document.getElementById('statusDisponibilidade').textContent = foodData.disponibilidade.detalhes;
                
                document.getElementById('acessoAlimentos').textContent = foodData.acesso.status;
                document.getElementById('statusAcesso').textContent = foodData.acesso.detalhes;
                
                document.getElementById('precosAlimentos').textContent = foodData.precos.status;
                document.getElementById('tendenciaPrecos').textContent = foodData.precos.detalhes;
                
                document.getElementById('producaoAgricola').textContent = foodData.producao.status;
                document.getElementById('statusProducao').textContent = foodData.producao.detalhes;
                
                // Atualizar gr√°fico
                updateFoodSecurityChart(foodData.tendencias);
                
            } catch (error) {
                console.error('Error loading food security data:', error);
            }
        }

        function generateFoodSecurityData() {
            // Gerar dados simulados para seguran√ßa alimentar
            const statusOptions = ['EST√ÅVEL', 'ALERTA', 'CR√çTICO'];
            const tendencias = ['Melhorando', 'Est√°vel', 'Piorando'];
            
            return {
                disponibilidade: {
                    status: statusOptions[Math.floor(Math.random() * 2)], // N√£o cr√≠tico por padr√£o
                    detalhes: 'Estoque regional dentro da normalidade'
                },
                acesso: {
                    status: statusOptions[Math.floor(Math.random() * 3)],
                    detalhes: 'Acessibilidade vari√°vel por regi√£o'
                },
                precos: {
                    status: statusOptions[Math.floor(Math.random() * 3)],
                    detalhes: tendencias[Math.floor(Math.random() * 3)] + ' para alimentos b√°sicos'
                },
                producao: {
                    status: statusOptions[Math.floor(Math.random() * 3)],
                    detalhes: 'Safra ' + tendencias[Math.floor(Math.random() * 3)].toLowerCase()
                },
                tendencias: {
                    meses: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun'],
                    disponibilidade: [85, 82, 78, 75, 80, 82],
                    acesso: [70, 68, 65, 62, 65, 67],
                    precos: [100, 105, 110, 115, 112, 108],
                    producao: [90, 88, 85, 80, 82, 85]
                }
            };
        }

        function updateFoodSecurityChart(tendencias) {
            const ctx = document.getElementById('foodSecurityChart').getContext('2d');
            
            // Destruir gr√°fico anterior se existir
            if (foodSecurityChart) {
                foodSecurityChart.destroy();
            }
            
            foodSecurityChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: tendencias.meses,
                    datasets: [
                        {
                            label: 'Disponibilidade (%)',
                            data: tendencias.disponibilidade,
                            borderColor: '#10B981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            tension: 0.3,
                            fill: true
                        },
                        {
                            label: 'Acesso (%)',
                            data: tendencias.acesso,
                            borderColor: '#F59E0B',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            tension: 0.3,
                            fill: true
                        },
                        {
                            label: 'Pre√ßos (√çndice)',
                            data: tendencias.precos,
                            borderColor: '#EF4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            tension: 0.3,
                            fill: true
                        },
                        {
                            label: 'Produ√ß√£o (%)',
                            data: tendencias.producao,
                            borderColor: '#3B82F6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.3,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Indicadores de Seguran√ßa Alimentar - √öltimos 6 Meses'
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: 'Valores Normalizados'
                            }
                        }
                    }
                }
            });
        }

        async function loadFoodSecurityNews() {
            try {
                // Simular not√≠cias sobre seguran√ßa alimentar (em produ√ß√£o, integrar com APIs de not√≠cias)
                const news = [
                    {
                        title: 'Mudan√ßas clim√°ticas amea√ßam produ√ß√£o de alimentos b√°sicos no Brasil',
                        source: 'FAO Brasil',
                        date: '15/03/2025',
                        summary: 'Estudo alerta para redu√ß√£o na produ√ß√£o de milho e feij√£o devido a eventos clim√°ticos extremos'
                    },
                    {
                        title: 'Pre√ßo da cesta b√°sica sobe 8% no √∫ltimo trimestre',
                        source: 'DIEESE',
                        date: '12/03/2025',
                        summary: 'Aumento √© atribu√≠do a quebras de safra e dificuldades log√≠sticas'
                    },
                    {
                        title: 'Programa incentiva agricultura familiar resiliente ao clima',
                        source: 'MAPA',
                        date: '10/03/2025',
                        summary: 'Iniciativa promove t√©cnicas agr√≠colas adaptadas √†s mudan√ßas clim√°ticas'
                    },
                    {
                        title: 'Secas prolongadas afetam seguran√ßa h√≠drica no Nordeste',
                        source: 'ANA',
                        date: '08/03/2025',
                        summary: 'Registro de menor volume de chuvas em 30 anos preocupa especialistas'
                    }
                ];

                displayFoodSecurityNews(news);
            } catch (error) {
                console.error('Error loading food security news:', error);
                document.getElementById('noticiasSegurancaAlimentar').innerHTML = 
                    '<div class="text-red-500 text-center py-4">Erro ao carregar not√≠cias. Tente atualizar a p√°gina.</div>';
            }
        }

        function displayFoodSecurityNews(news) {
            document.getElementById('noticiasSegurancaAlimentar').innerHTML = news.map(item => `
                <div class="border-l-4 border-green-500 bg-gray-50 p-4 rounded-r-lg hover:bg-green-50 transition">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="font-bold text-gray-800 flex-1">${item.title}</h3>
                        <span class="text-xs text-gray-500 bg-white px-2 py-1 rounded ml-2">${item.source}</span>
                    </div>
                    <p class="text-sm text-gray-600 mb-2">${item.summary}</p>
                    <div class="flex justify-between items-center">
                        <span class="text-xs text-gray-500">${item.date}</span>
                        <span class="text-green-600 text-xs font-semibold">Not√≠cia relacionada</span>
                    </div>
                </div>
            `).join('');
        }

        async function loadHealthImpacts() {
            try {
                const response = await fetch(
                    `https://api.openweathermap.org/data/2.5/weather?lat=${userLocation.lat}&lon=${userLocation.lon}&appid=${OPENWEATHER_API_KEY}&units=metric`
                );
                const data = await response.json();

                const healthAnalysis = analyzeHealthImpacts(data);
                
                document.getElementById('health-impacts').innerHTML = healthAnalysis.map(item => `
                    <div class="bg-${item.color}-50 border-l-4 border-${item.color}-500 p-3 rounded">
                        <h3 class="font-bold text-${item.color}-800 mb-1">${item.title}</h3>
                        <p class="text-${item.color}-700 text-sm">${item.description}</p>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading health impacts:', error);
            }
        }

        function analyzeHealthImpacts(climateData) {
            const temp = climateData.main.temp;
            const humidity = climateData.main.humidity;
            const impacts = [];

            if (temp > 32) {
                impacts.push({
                    title: 'üö® Risco de Desidrata√ß√£o e Insola√ß√£o',
                    description: 'Temperaturas acima de 32¬∞C aumentam risco de desidrata√ß√£o em 60%. Crian√ßas e idosos s√£o mais vulner√°veis.',
                    color: 'red'
                });
            }

            if (humidity < 30) {
                impacts.push({
                    title: 'üåµ Problemas Respirat√≥rios',
                    description: 'Umidade baixa resseca vias a√©reas, aumentando crises de asma e rinite em 40%.',
                    color: 'orange'
                });
            }

            // Adicionar impactos espec√≠ficos na seguran√ßa alimentar
            impacts.push({
                title: 'üçé Seguran√ßa Alimentar',
                description: 'Condi√ß√µes clim√°ticas atuais podem afetar a disponibilidade e qualidade dos alimentos.',
                color: 'yellow'
            });

            if (impacts.length === 0) {
                impacts.push({
                    title: '‚úÖ Condi√ß√µes Favor√°veis',
                    description: 'Condi√ß√µes clim√°ticas atuais n√£o apresentam riscos significativos √† sa√∫de.',
                    color: 'green'
                });
            }

            return impacts;
        }

        async function loadPreventionActions() {
            try {
                const response = await fetch(
                    `https://api.openweathermap.org/data/2.5/weather?lat=${userLocation.lat}&lon=${userLocation.lon}&appid=${OPENWEATHER_API_KEY}&units=metric`
                );
                const data = await response.json();

                const actions = generatePreventionActions(data);
                
                document.getElementById('prevention-actions').innerHTML = actions.map(action => `
                    <div class="bg-green-50 border-l-4 border-green-500 p-3 rounded">
                        <h3 class="font-bold text-green-800 mb-1">${action.timeframe}</h3>
                        <p class="text-green-700 text-sm">${action.action}</p>
                        <p class="text-green-600 text-xs mt-1"><strong>Porque:</strong> ${action.reason}</p>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading prevention actions:', error);
            }
        }

        function generatePreventionActions(climateData) {
            const temp = climateData.main.temp;
            const actions = [];

            if (temp > 32) {
                actions.push({
                    timeframe: 'üïê PR√ìXIMAS 24 HORAS',
                    action: 'Beber 2-3 litros de √°gua. Evitar exposi√ß√£o solar entre 10h-16h.',
                    reason: 'Prevenir desidrata√ß√£o e golpes de calor'
                });
            }

            actions.push({
                timeframe: 'üå± SEGURAN√áA ALIMENTAR',
                action: 'Diversificar fontes de alimentos. Priorizar produtos da esta√ß√£o.',
                reason: 'Reduzir depend√™ncia de cadeias log√≠sticas vulner√°veis'
            });

            actions.push({
                timeframe: 'üèòÔ∏è COMUNIDADE',
                action: 'Participar de hortas comunit√°rias e compartilhar informa√ß√µes locais.',
                reason: 'Fortalecer resili√™ncia comunit√°ria frente a crises alimentares'
            });

            return actions;
        }

        async function loadOfficialNews() {
            try {
                // Usar CORS proxy para evitar bloqueios
                const response = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent('https://g1.globo.com/rss/g1/ciencia-e-saude/')}`);
                const data = await response.json();
                const text = data.contents;
                
                const parser = new DOMParser();
                const xml = parser.parseFromString(text, 'text/xml');
                const items = xml.querySelectorAll('item');
                
                const news = Array.from(items).slice(0, 5).map(item => {
                    const title = item.querySelector('title').textContent;
                    const link = item.querySelector('link').textContent;
                    const pubDate = new Date(item.querySelector('pubDate').textContent);
                    
                    return {
                        title,
                        link,
                        date: pubDate.toLocaleDateString('pt-BR'),
                        time: pubDate.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })
                    };
                });

                displayNews(news);
            } catch (error) {
                console.error('Error loading news:', error);
                document.getElementById('noticiasContainer').innerHTML = 
                    '<div class="text-red-500 text-center py-4">Erro ao carregar not√≠cias. Tente atualizar a p√°gina.</div>';
            }
        }

        function displayNews(news) {
            document.getElementById('noticiasContainer').innerHTML = news.map(item => `
                <div class="border-l-4 border-blue-500 bg-gray-50 p-4 rounded-r-lg hover:bg-blue-50 transition cursor-pointer" 
                     onclick="window.open('${item.link}', '_blank')">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="font-bold text-gray-800 flex-1">${item.title}</h3>
                        <span class="text-xs text-gray-500 bg-white px-2 py-1 rounded ml-2">G1</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs text-gray-500">${item.date} √†s ${item.time}</span>
                        <span class="text-blue-600 text-xs font-semibold">Ler not√≠cia ‚Üí</span>
                    </div>
                </div>
            `).join('');
        }

        // ========== SISTEMA DE RELATOS COMUNIT√ÅRIOS ==========
        document.getElementById('formRelato').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const relato = {
                id: Date.now(),
                tipo: document.getElementById('tipoProblema').value,
                gravidade: document.getElementById('gravidade').value,
                bairro: document.getElementById('bairroRelato').value,
                cidade: document.getElementById('cidadeRelato').value,
                estado: document.getElementById('estadoRelato').value,
                descricao: document.getElementById('descricaoRelato').value,
                data: new Date().toLocaleString('pt-BR'),
                coordenadas: obterCoordenadasProximas(userLocation),
                status: 'ativo'
            };
            
            salvarRelato(relato);
            adicionarRelatoLista(relato);
            atualizarMetricas();
            atualizarRankings();
            this.reset();
            
            mostrarNotificacao('‚úÖ Relato enviado com sucesso! Sua contribui√ß√£o ajuda toda a comunidade.', 'success');
        });

        function obterCoordenadasProximas(base) {
            return {
                lat: base.lat + (Math.random() - 0.5) * 0.02,
                lon: base.lon + (Math.random() - 0.5) * 0.02
            };
        }

        function salvarRelato(relato) {
            let relatos = JSON.parse(localStorage.getItem('relatosEcoImpacto') || '[]');
            relatos.unshift(relato);
            localStorage.setItem('relatosEcoImpacto', JSON.stringify(relatos));
            todosRelatos = relatos;
        }

        function carregarRelatos() {
            const relatos = JSON.parse(localStorage.getItem('relatosEcoImpacto') || '[]');
            todosRelatos = relatos;
            const container = document.getElementById('listaRelatos');
            
            if (relatos.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-inbox text-4xl mb-4"></i>
                        <p>Nenhum relato enviado ainda. Seja o primeiro a contribuir!</p>
                        <p class="text-sm mt-2">Seu relato ajuda a identificar problemas e proteger a comunidade.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = relatos.slice(0, 8).map(relato => `
                <div class="border-l-4 ${getCorBorda(relato.gravidade)} bg-gray-50 p-4 rounded-r-lg ranking-item">
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <span class="font-semibold">${relato.bairro}, ${relato.cidade}</span>
                            <span class="text-sm text-gray-500 ml-2">${relato.data}</span>
                        </div>
                        <span class="text-xs font-semibold px-2 py-1 rounded-full ${getCorGravidade(relato.gravidade)}">
                            ${relato.gravidade.toUpperCase()}
                        </span>
                    </div>
                    <p class="text-gray-700 text-sm">${relato.descricao}</p>
                    <div class="flex justify-between items-center mt-3">
                        <span class="text-xs text-gray-500">${getTipoTexto(relato.tipo)}</span>
                        <button onclick="verDetalhesRelato(${relato.id})" class="text-green-600 text-xs font-semibold flex items-center">
                            <i class="fas fa-search mr-1"></i> Ver Impacto
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function adicionarRelatoLista(relato) {
            const container = document.getElementById('listaRelatos');
            const novoRelatoHTML = `
                <div class="border-l-4 ${getCorBorda(relato.gravidade)} bg-gray-50 p-4 rounded-r-lg ranking-item">
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <span class="font-semibold">${relato.bairro}, ${relato.cidade}</span>
                            <span class="text-sm text-gray-500 ml-2">${relato.data}</span>
                        </div>
                        <span class="text-xs font-semibold px-2 py-1 rounded-full ${getCorGravidade(relato.gravidade)}">
                            ${relato.gravidade.toUpperCase()}
                        </span>
                    </div>
                    <p class="text-gray-700 text-sm">${relato.descricao}</p>
                    <div class="flex justify-between items-center mt-3">
                        <span class="text-xs text-gray-500">${getTipoTexto(relato.tipo)}</span>
                        <button onclick="verDetalhesRelato(${relato.id})" class="text-green-600 text-xs font-semibold flex items-center">
                            <i class="fas fa-search mr-1"></i> Ver Impacto
                        </button>
                    </div>
                </div>
            `;
            
            if (container.children.length > 0 && !container.children[0].classList.contains('text-center')) {
                container.insertAdjacentHTML('afterbegin', novoRelatoHTML);
            } else {
                container.innerHTML = novoRelatoHTML;
            }
        }

        function verDetalhesRelato(id) {
            const relato = todosRelatos.find(r => r.id === id);
            if (relato) {
                const impactos = gerarAnaliseImpacto(relato);
                alert(`üìä AN√ÅLISE DE IMPACTO - Relato #${id}\n\n` +
                      `üìç Local: ${relato.bairro}, ${relato.cidade}\n` +
                      `‚ö†Ô∏è Problema: ${getTipoTexto(relato.tipo)}\n` +
                      `üö® Gravidade: ${relato.gravidade}\n\n` +
                      `üìà IMPACTOS IDENTIFICADOS:\n` +
                      `‚Ä¢ ${impactos.saude}\n` +
                      `‚Ä¢ ${impactos.alimentar}\n` +
                      `‚Ä¢ ${impactos.seguranca}\n\n` +
                      `üí° RECOMENDA√á√ïES:\n${impactos.recomendacoes}`);
            }
        }

        // ========== SISTEMA DE RANKING DE √ÅREAS CR√çTICAS ==========
        function atualizarRankings() {
            atualizarRankingBairros();
            atualizarRankingProblemas();
        }

        function atualizarRankingBairros() {
            const relatosPorBairro = {};
            
            todosRelatos.forEach(relato => {
                const chave = `${relato.bairro}, ${relato.cidade}`;
                if (!relatosPorBairro[chave]) {
                    relatosPorBairro[chave] = { total: 0, criticos: 0 };
                }
                relatosPorBairro[chave].total++;
                if (relato.gravidade === 'critica') {
                    relatosPorBairro[chave].criticos++;
                }
            });

            const bairrosOrdenados = Object.entries(relatosPorBairro)
                .sort(([,a], [,b]) => b.criticos - a.criticos || b.total - a.total)
                .slice(0, 5);

            const container = document.getElementById('rankingBairros');
            
            if (bairrosOrdenados.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-4 text-gray-500">
                        <i class="fas fa-chart-bar text-2xl mb-2"></i>
                        <p>Nenhum relato ainda</p>
                        <p class="text-sm">Os rankings aparecer√£o aqui</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = bairrosOrdenados.map(([bairro, dados], index) => `
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg ranking-item">
                    <div class="flex items-center">
                        <div class="w-8 h-8 rounded-full ${index === 0 ? 'bg-red-500' : index === 1 ? 'bg-orange-500' : index === 2 ? 'bg-yellow-500' : 'bg-blue-500'} flex items-center justify-center text-white font-bold text-sm">
                            ${index + 1}
                        </div>
                        <div class="ml-3">
                            <p class="font-semibold text-sm">${bairro.split(',')[0]}</p>
                            <p class="text-xs text-gray-500">${dados.total} relatos</p>
                        </div>
                    </div>
                    <span class="text-xs font-semibold px-2 py-1 rounded-full ${dados.criticos > 0 ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}">
                        ${dados.criticos} cr√≠ticos
                    </span>
                </div>
            `).join('');
        }

        function atualizarRankingProblemas() {
            const problemasContagem = {};
            
            todosRelatos.forEach(relato => {
                const problema = getTipoTexto(relato.tipo);
                problemasContagem[problema] = (problemasContagem[problema] || 0) + 1;
            });

            const problemasOrdenados = Object.entries(problemasContagem)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 5);

            const container = document.getElementById('rankingProblemas');
            
            if (problemasOrdenados.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-4 text-gray-500">
                        <i class="fas fa-exclamation-triangle text-2xl mb-2"></i>
                        <p>Nenhum problema reportado</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = problemasOrdenados.map(([problema, quantidade], index) => `
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg ranking-item">
                    <div class="flex items-center">
                        <div class="w-8 h-8 rounded-full ${index === 0 ? 'bg-red-500' : index === 1 ? 'bg-orange-500' : index === 2 ? 'bg-yellow-500' : 'bg-blue-500'} flex items-center justify-center text-white font-bold text-sm">
                            ${index + 1}
                        </div>
                        <div class="ml-3">
                            <p class="font-semibold text-sm">${problema}</p>
                            <p class="text-xs text-gray-500">${quantidade} ocorr√™ncias</p>
                        </div>
                    </div>
                    <div class="w-16 bg-gray-200 rounded-full h-2">
                        <div class="bg-green-500 h-2 rounded-full" style="width: ${(quantidade / Math.max(...Object.values(problemasContagem))) * 100}%"></div>
                    </div>
                </div>
            `).join('');
        }

        // ========== SISTEMA DE DIAGN√ìSTICO DE IMPACTO ==========
        function gerarDiagnosticoImpacto() {
            const container = document.getElementById('diagnosticoImpacto');
            const relatosRecentes = todosRelatos.filter(r => {
                const dataRelato = new Date(r.id);
                const hoje = new Date();
                return (hoje - dataRelato) < 7 * 24 * 60 * 60 * 1000;
            });

            let analiseGeral = "‚úÖ Situa√ß√£o est√°vel na regi√£o";
            let detalhes = "Baixo n√∫mero de relatos cr√≠ticos recentes.";

            if (relatosRecentes.length > 0) {
                const criticos = relatosRecentes.filter(r => r.gravidade === 'critica').length;
                const percentualCriticos = (criticos / relatosRecentes.length) * 100;

                if (percentualCriticos > 30) {
                    analiseGeral = "üö® SITUA√á√ÉO CR√çTICA";
                    detalhes = "Alto n√∫mero de relatos graves requer aten√ß√£o imediata das autoridades.";
                } else if (percentualCriticos > 15) {
                    analiseGeral = "‚ö†Ô∏è SITUA√á√ÉO DE ALERTA";
                    detalhes = "Aumento de relatos preocupantes - monitoramento intensivo necess√°rio.";
                }
            }

            container.innerHTML = `
                <div class="bg-white border-l-4 ${analiseGeral.includes('CR√çTICA') ? 'border-red-500 bg-red-50' : analiseGeral.includes('ALERTA') ? 'border-orange-500 bg-orange-50' : 'border-green-500 bg-green-50'} p-4 rounded-r-lg">
                    <div class="flex items-start">
                        <i class="fas ${analiseGeral.includes('CR√çTICA') ? 'fa-exclamation-triangle text-red-500' : analiseGeral.includes('ALERTA') ? 'fa-exclamation-circle text-orange-500' : 'fa-check-circle text-green-500'} text-xl mr-3 mt-1"></i>
                        <div>
                            <h5 class="font-bold ${analiseGeral.includes('CR√çTICA') ? 'text-red-800' : analiseGeral.includes('ALERTA') ? 'text-orange-800' : 'text-green-800'}">${analiseGeral}</h5>
                            <p class="${analiseGeral.includes('CR√çTICA') ? 'text-red-700' : analiseGeral.includes('ALERTA') ? 'text-orange-700' : 'text-green-700'} text-sm">${detalhes}</p>
                            <div class="mt-2 grid grid-cols-2 gap-2 text-xs">
                                <div><strong>Relatos 7 dias:</strong> ${relatosRecentes.length}</div>
                                <div><strong>Cr√≠ticos:</strong> ${relatosRecentes.filter(r => r.gravidade === 'critica').length}</div>
                                <div><strong>Monitoramento:</strong> Ativo</div>
                                <div><strong>√öltima atualiza√ß√£o:</strong> Agora</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-blue-50 p-4 rounded-lg">
                    <h6 class="font-semibold text-blue-800 mb-2">üìà Impactos na Sa√∫de e Seguran√ßa Alimentar</h6>
                    <ul class="text-sm text-blue-700 space-y-1">
                        <li>‚Ä¢ Condi√ß√µes clim√°ticas: ${document.getElementById('impactoAlimentar')?.textContent || 'Monitorando'}</li>
                        <li>‚Ä¢ Seguran√ßa alimentar: ${document.getElementById('segurancaAlimentar')?.textContent || 'Avaliando'}</li>
                        <li>‚Ä¢ Riscos √† sa√∫de: ${document.getElementById('saudePublica')?.textContent || 'Analisando'}</li>
                        <li>‚Ä¢ Comunidade: ${todosRelatos.length} relatos ativos</li>
                    </ul>
                </div>
            `;
        }

        // ========== SISTEMA DE DIAGN√ìSTICO IA ==========
        async function gerarDiagnostico(escopo) {
            const button = event.target;
            const originalText = button.innerHTML;
            
            button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Analisando...';
            button.disabled = true;
            
            try {
                await new Promise(resolve => setTimeout(resolve, 2500));
                
                const diagnostico = await gerarDiagnosticoCompleto(escopo);
                document.getElementById('diagnosticoResultado').innerHTML = diagnostico;
                
            } catch (error) {
                document.getElementById('diagnosticoResultado').innerHTML = `
                    <div class="bg-red-50 p-4 rounded-lg border border-red-200">
                        <div class="flex items-start">
                            <i class="fas fa-exclamation-triangle text-red-500 text-xl mr-3 mt-1"></i>
                            <div>
                                <h5 class="font-semibold text-red-800">Erro na An√°lise</h5>
                                <p class="text-red-700">N√£o foi poss√≠vel gerar o diagn√≥stico. Tente novamente.</p>
                            </div>
                        </div>
                    </div>
                `;
            } finally {
                button.innerHTML = originalText;
                button.disabled = false;
            }
        }

        async function gerarDiagnosticoCompleto(escopo) {
            let area = escopo === 'bairro' ? userBairro : escopo === 'cidade' ? userCidade : 'Sua Regi√£o';
            
            const relatosArea = todosRelatos.filter(r => 
                escopo === 'bairro' ? r.bairro === userBairro :
                escopo === 'cidade' ? r.cidade === userCidade : true
            );

            const totalRelatos = relatosArea.length;
            const relatosCriticos = relatosArea.filter(r => r.gravidade === 'critica').length;
            
            const analise = gerarAnalisePreditiva(escopo, relatosArea);
            
            return `
                <div class="space-y-4">
                    <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                        <div class="flex items-start">
                            <i class="fas fa-robot text-green-500 text-xl mr-3 mt-1"></i>
                            <div>
                                <h5 class="font-semibold text-green-800 mb-2">Diagn√≥stico IA - ${area}</h5>
                                <p class="text-green-700">${analise.geral}</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div class="bg-white p-3 rounded-lg border">
                            <strong>üìä Dados Coletados</strong>
                            <p>Relatos totais: ${totalRelatos}</p>
                            <p>Relatos cr√≠ticos: ${relatosCriticos}</p>
                            <p>√Årea analisada: ${area}</p>
                        </div>
                        <div class="bg-white p-3 rounded-lg border">
                            <strong>üîç An√°lise Preditiva</strong>
                            <p>Tend√™ncia: ${analise.tendencia}</p>
                            <p>Confian√ßa: ${analise.confianca}</p>
                            <p>Horizonte: 7 dias</p>
                        </div>
                    </div>
                    
                    <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                        <h6 class="font-semibold text-yellow-800 mb-2">üéØ Impactos Esperados</h6>
                        <ul class="text-sm text-yellow-700 space-y-1">
                            <li>‚Ä¢ ${analise.impactos.saude}</li>
                            <li>‚Ä¢ ${analise.impactos.alimentar}</li>
                            <li>‚Ä¢ ${analise.impactos.seguranca}</li>
                        </ul>
                    </div>
                    
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                        <h6 class="font-semibold text-blue-800 mb-2">üí° Recomenda√ß√µes de A√ß√£o</h6>
                        <div class="text-sm text-blue-700 space-y-2">
                            ${analise.recomendacoes.map(rec => `<p>‚Ä¢ ${rec}</p>`).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function gerarAnalisePreditiva(escopo, relatos) {
            return {
                geral: `An√°lise completa da ${escopo} baseada em ${relatos.length} relatos e dados clim√°ticos. Situa√ß√£o ${Math.random() > 0.7 ? 'requer aten√ß√£o' : 'sob monitoramento'}.`,
                tendencia: 'Estabilizando',
                confianca: '85%',
                impactos: {
                    saude: "Risco moderado de doen√ßas respirat√≥rias devido √†s condi√ß√µes clim√°ticas",
                    alimentar: "Estabilidade alimentar com monitoramento de pre√ßos e disponibilidade",
                    seguranca: "Condi√ß√µes normais de seguran√ßa comunit√°ria"
                },
                recomendacoes: [
                    "Manter hidrata√ß√£o adequada devido √†s temperaturas",
                    "Monitorar qualidade do ar para grupos de risco",
                    "Manter estoque b√°sico de alimentos n√£o perec√≠veis",
                    "Reportar qualquer mudan√ßa nas condi√ß√µes locais"
                ]
            };
        }

        function gerarAnaliseImpacto(relato) {
            const analises = {
                seca: {
                    saude: "Risco de desidrata√ß√£o e problemas renais",
                    alimentar: "Redu√ß√£o na produ√ß√£o de alimentos frescos",
                    seguranca: "Poss√≠veis conflitos por recursos h√≠dricos",
                    recomendacoes: "Armazenar √°gua pot√°vel\nPlantar esp√©cies resistentes\nReportar √† defesa civil"
                },
                inundacao: {
                    saude: "Risco de leptospirose e doen√ßas h√≠dricas", 
                    alimentar: "Perda de estoques e contamina√ß√£o de alimentos",
                    seguranca: "Isolamento de comunidades e danos estruturais",
                    recomendacoes: "Evitar contato com √°gua contaminada\nFerver √°gua para consumo\nTer plano de evacua√ß√£o"
                },
                inseguranca_alimentar: {
                    saude: "Risco de desnutri√ß√£o e problemas de desenvolvimento",
                    alimentar: "Falta de acesso a alimentos nutritivos",
                    seguranca: "Aumento da vulnerabilidade social",
                    recomendacoes: "Buscar programas de assist√™ncia alimentar\nParticipar de hortas comunit√°rias\nCompartilhar recursos locais"
                },
                aumento_precos: {
                    saude: "Risco de dieta inadequada por restri√ß√µes financeiras",
                    alimentar: "Dificuldade de acesso a alimentos por pre√ßos elevados",
                    seguranca: "Aumento da desigualdade social",
                    recomendacoes: "Priorizar alimentos da esta√ß√£o\nBuscar alternativas locais\nParticipar de cooperativas de consumo"
                }
            };
            
            return analises[relato.tipo] || {
                saude: "Impacto vari√°vel dependendo da gravidade",
                alimentar: "Pode afetar disponibilidade e acesso a alimentos",
                seguranca: "Situa√ß√£o requer monitoramento cont√≠nuo", 
                recomendacoes: "Manter comunica√ß√£o com autoridades locais\nParticipar da comunidade\nReportar mudan√ßas nas condi√ß√µes"
            };
        }

        // ========== FUN√á√ïES DO DASHBOARD ESTADUAL ==========
        function carregarDashboardEstadual() {
            const estadoSelecionado = document.getElementById('selecionarEstado').value;
            atualizarVisaoGeralEstadual(estadoSelecionado);
            atualizarTabelaCidades(estadoSelecionado);
            atualizarGraficoProblemas(estadoSelecionado);
            carregarNoticiasEstado(estadoSelecionado);
        }

        function atualizarVisaoGeralEstadual(estado) {
            const container = document.getElementById('visaoGeralEstadual');
            
            if (!estado) {
                container.innerHTML = `
                    <div class="col-span-4 text-center py-8 text-gray-500">
                        <i class="fas fa-map-marked-alt text-3xl mb-3"></i>
                        <p>Selecione um estado para visualizar os dados</p>
                    </div>
                `;
                return;
            }

            const relatosEstado = todosRelatos.filter(relato => relato.estado === estado);
            const relatos7Dias = relatosEstado.filter(relato => {
                const dataRelato = new Date(relato.id);
                return (Date.now() - dataRelato) < 7 * 24 * 60 * 60 * 1000;
            });

            const relatosCriticos = relatosEstado.filter(r => r.gravidade === 'critica').length;
            const problemasUnicos = [...new Set(relatosEstado.map(r => r.tipo))].length;

            // An√°lise de tend√™ncia
            const relatosOntem = relatosEstado.filter(relato => {
                const dataRelato = new Date(relato.id);
                const ontem = new Date(Date.now() - 24 * 60 * 60 * 1000);
                return dataRelato > ontem;
            }).length;

            const tendencia = relatosOntem > (relatos7Dias.length / 7) ? 'alta' : 'estavel';

            container.innerHTML = `
                <div class="bg-white p-6 rounded-xl shadow-md card-hover border-l-4 border-blue-500">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-sm text-gray-500">Total de Relatos</p>
                            <p class="text-2xl font-bold text-blue-600">${relatosEstado.length}</p>
                        </div>
                        <i class="fas fa-bullhorn text-blue-500 text-xl"></i>
                    </div>
                    <p class="text-xs text-gray-600 mt-2">Estado ${getNomeEstado(estado)}</p>
                </div>
                
                <div class="bg-white p-6 rounded-xl shadow-md card-hover border-l-4 border-red-500">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-sm text-gray-500">Relatos Cr√≠ticos</p>
                            <p class="text-2xl font-bold text-red-600">${relatosCriticos}</p>
                        </div>
                        <i class="fas fa-exclamation-triangle text-red-500 text-xl"></i>
                    </div>
                    <p class="text-xs text-gray-600 mt-2">${((relatosCriticos / relatosEstado.length) * 100 || 0).toFixed(1)}% do total</p>
                </div>
                
                <div class="bg-white p-6 rounded-xl shadow-md card-hover border-l-4 border-green-500">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-sm text-gray-500">Tipos de Problemas</p>
                            <p class="text-2xl font-bold text-green-600">${problemasUnicos}</p>
                        </div>
                        <i class="fas fa-list-alt text-green-500 text-xl"></i>
                    </div>
                    <p class="text-xs text-gray-600 mt-2">Diversidade de issues</p>
                </div>
                
                <div class="bg-white p-6 rounded-xl shadow-md card-hover border-l-4 ${tendencia === 'alta' ? 'border-orange-500' : 'border-purple-500'}">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-sm text-gray-500">Tend√™ncia</p>
                            <p class="text-2xl font-bold ${tendencia === 'alta' ? 'text-orange-600' : 'text-purple-600'}">${tendencia === 'alta' ? 'ALTA' : 'EST√ÅVEL'}</p>
                        </div>
                        <i class="fas ${tendencia === 'alta' ? 'fa-arrow-up text-orange-500' : 'fa-minus text-purple-500'} text-xl"></i>
                    </div>
                    <p class="text-xs text-gray-600 mt-2">√öltimos 7 dias</p>
                </div>
            `;
        }

        function atualizarTabelaCidades(estado) {
            const container = document.getElementById('dadosTabelaCidades');
            
            if (!estado) {
                container.innerHTML = `
                    <tr>
                        <td colspan="5" class="py-4 text-center text-gray-500">
                            Selecione um estado para ver os dados das cidades
                        </td>
                    </tr>
                `;
                return;
            }

            const relatosEstado = todosRelatos.filter(relato => relato.estado === estado);
            
            // Agrupar por cidade
            const cidadesMap = {};
            relatosEstado.forEach(relato => {
                if (!cidadesMap[relato.cidade]) {
                    cidadesMap[relato.cidade] = {
                        relatos: [],
                        problemas: {}
                    };
                }
                cidadesMap[relato.cidade].relatos.push(relato);
                
                // Contar problemas por tipo
                if (!cidadesMap[relato.cidade].problemas[relato.tipo]) {
                    cidadesMap[relato.cidade].problemas[relato.tipo] = 0;
                }
                cidadesMap[relato.cidade].problemas[relato.tipo]++;
            });

            // Ordenar cidades por n√∫mero de relatos
            const cidadesOrdenadas = Object.entries(cidadesMap)
                .map(([cidade, dados]) => ({
                    cidade,
                    totalRelatos: dados.relatos.length,
                    problemaPrincipal: Object.entries(dados.problemas)
                        .sort(([,a], [,b]) => b - a)[0],
                    ultimoRelato: Math.max(...dados.relatos.map(r => r.id)),
                    gravidade: dados.relatos.some(r => r.gravidade === 'critica') ? 'Cr√≠tica' : 
                              dados.relatos.some(r => r.gravidade === 'alta') ? 'Alta' : 'M√©dia'
                }))
                .sort((a, b) => b.totalRelatos - a.totalRelatos)
                .slice(0, 10);

            if (cidadesOrdenadas.length === 0) {
                container.innerHTML = `
                    <tr>
                        <td colspan="5" class="py-4 text-center text-gray-500">
                            Nenhum relato encontrado para este estado
                        </td>
                    </tr>
                `;
                return;
            }

            container.innerHTML = cidadesOrdenadas.map(cidade => `
                <tr class="border-b hover:bg-gray-50">
                    <td class="py-3 px-4 font-semibold">${cidade.cidade}</td>
                    <td class="py-3 px-4">${getTipoTexto(cidade.problemaPrincipal[0])}</td>
                    <td class="py-3 px-4">
                        <span class="px-2 py-1 rounded-full text-xs font-semibold ${getCorGravidade(cidade.gravidade.toLowerCase())}">
                            ${cidade.gravidade}
                        </span>
                    </td>
                    <td class="py-3 px-4">${cidade.totalRelatos}</td>
                    <td class="py-3 px-4 text-sm text-gray-500">${new Date(cidade.ultimoRelato).toLocaleDateString('pt-BR')}</td>
                </tr>
            `).join('');
        }

        function atualizarGraficoProblemas(estado) {
            const ctx = document.getElementById('graficoProblemasEstado').getContext('2d');
            
            if (!estado) {
                if (graficoProblemasEstado) {
                    graficoProblemasEstado.destroy();
                }
                return;
            }

            const relatosEstado = todosRelatos.filter(relato => relato.estado === estado);
            
            // Agrupar problemas por tipo
            const problemasMap = {};
            relatosEstado.forEach(relato => {
                if (!problemasMap[relato.tipo]) {
                    problemasMap[relato.tipo] = 0;
                }
                problemasMap[relato.tipo]++;
            });

            const problemasOrdenados = Object.entries(problemasMap)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 8);

            // Destruir gr√°fico anterior se existir
            if (graficoProblemasEstado) {
                graficoProblemasEstado.destroy();
            }

            graficoProblemasEstado = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: problemasOrdenados.map(([tipo]) => getTipoTexto(tipo)),
                    datasets: [{
                        data: problemasOrdenados.map(([,quantidade]) => quantidade),
                        backgroundColor: [
                            '#EF4444', '#F59E0B', '#10B981', '#3B82F6',
                            '#8B5CF6', '#EC4899', '#06B6D4', '#84CC16'
                        ],
                        borderWidth: 2,
                        borderColor: '#FFFFFF'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                boxWidth: 12,
                                font: {
                                    size: 11
                                }
                            }
                        },
                        title: {
                            display: true,
                            text: `Distribui√ß√£o de Problemas - ${getNomeEstado(estado)}`
                        }
                    }
                }
            });
        }

        async function carregarNoticiasEstado(estado) {
            const container = document.getElementById('conteudoNoticiasEstado');
            
            if (!estado) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-newspaper text-3xl mb-3"></i>
                        <p>Selecione um estado para ver not√≠cias relacionadas</p>
                    </div>
                `;
                return;
            }

            const nomeEstado = getNomeEstado(estado);
            
            try {
                // Buscar not√≠cias relacionadas ao estado
                const response = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(`https://news.google.com/rss/search?q=${encodeURIComponent(nomeEstado + ' clima seguran√ßa alimentar')}&hl=pt-BR&gl=BR&ceid=BR:pt-419`)}`);
                const data = await response.json();
                const text = data.contents;
                
                const parser = new DOMParser();
                const xml = parser.parseFromString(text, 'text/xml');
                const items = xml.querySelectorAll('item');
                
                const news = Array.from(items).slice(0, 5).map(item => {
                    const title = item.querySelector('title').textContent;
                    const link = item.querySelector('link').textContent;
                    const pubDate = new Date(item.querySelector('pubDate').textContent);
                    
                    return {
                        title,
                        link,
                        date: pubDate.toLocaleDateString('pt-BR'),
                        time: pubDate.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })
                    };
                });

                if (news.length > 0) {
                    container.innerHTML = news.map(item => `
                        <div class="border-l-4 border-orange-500 bg-gray-50 p-4 rounded-r-lg hover:bg-orange-50 transition cursor-pointer" 
                             onclick="window.open('${item.link}', '_blank')">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="font-bold text-gray-800 flex-1">${item.title}</h3>
                                <span class="text-xs text-gray-500 bg-white px-2 py-1 rounded ml-2">Google News</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-xs text-gray-500">${item.date} √†s ${item.time}</span>
                                <span class="text-orange-600 text-xs font-semibold">Ler not√≠cia ‚Üí</span>
                            </div>
                        </div>
                    `).join('');
                } else {
                    container.innerHTML = `
                        <div class="text-center py-8 text-gray-500">
                            <i class="fas fa-newspaper text-3xl mb-3"></i>
                            <p>Nenhuma not√≠cia encontrada para ${nomeEstado}</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading state news:', error);
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-exclamation-triangle text-3xl mb-3"></i>
                        <p>Erro ao carregar not√≠cias do estado</p>
                    </div>
                `;
            }
        }

        function getNomeEstado(sigla) {
            const estados = {
                'AC': 'Acre', 'AL': 'Alagoas', 'AP': 'Amap√°', 'AM': 'Amazonas',
                'BA': 'Bahia', 'CE': 'Cear√°', 'DF': 'Distrito Federal', 'ES': 'Esp√≠rito Santo',
                'GO': 'Goi√°s', 'MA': 'Maranh√£o', 'MT': 'Mato Grosso', 'MS': 'Mato Grosso do Sul',
                'MG': 'Minas Gerais', 'PA': 'Par√°', 'PB': 'Para√≠ba', 'PR': 'Paran√°',
                'PE': 'Pernambuco', 'PI': 'Piau√≠', 'RJ': 'Rio de Janeiro', 'RN': 'Rio Grande do Norte',
                'RS': 'Rio Grande do Sul', 'RO': 'Rond√¥nia', 'RR': 'Roraima', 'SC': 'Santa Catarina',
                'SP': 'S√£o Paulo', 'SE': 'Sergipe', 'TO': 'Tocantins'
            };
            return estados[sigla] || sigla;
        }

        // ========== FUN√á√ïES AUXILIARES ==========
        function getCorBorda(gravidade) {
            const cores = {
                'baixa': 'border-green-500',
                'media': 'border-yellow-500',
                'alta': 'border-orange-500', 
                'critica': 'border-red-500'
            };
            return cores[gravidade] || 'border-gray-500';
        }

        function getCorGravidade(gravidade) {
            const cores = {
                'baixa': 'bg-green-100 text-green-800',
                'media': 'bg-yellow-100 text-yellow-800',
                'alta': 'bg-orange-100 text-orange-800',
                'critica': 'bg-red-100 text-red-800'
            };
            return cores[gravidade] || 'bg-gray-100 text-gray-800';
        }

        function getTipoTexto(tipo) {
            const tipos = {
                'seca': 'Seca/Estiagem',
                'inundacao': 'Inunda√ß√£o/Alagamento',
                'queimada': 'Queimada/Inc√™ndio',
                'desmatamento': 'Desmatamento',
                'inseguranca_alimentar': 'Falta de Alimentos',
                'aumento_precos': 'Aumento de Pre√ßos',
                'perda_safra': 'Perda de Safra',
                'agua_contaminada': '√Ågua Contaminada', 
                'doencas': 'Surtos de Doen√ßas',
                'agricultura': 'Perda Agr√≠cola',
                'outro': 'Outro Problema'
            };
            return tipos[tipo] || 'Problema Ambiental';
        }

        function atualizarMetricas() {
            const relatosAtivos = todosRelatos.filter(r => r.status === 'ativo').length;
            document.getElementById('relatosAtivos').textContent = relatosAtivos;
        }

        function mostrarNotificacao(mensagem, tipo) {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 ${
                tipo === 'success' ? 'bg-green-500 text-white' : 'bg-red-500 text-white'
            }`;
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-${tipo === 'success' ? 'check' : 'exclamation-triangle'} mr-2"></i>
                    <span>${mensagem}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        function showError(message) {
            const alertBanner = document.getElementById('alertas');
            alertBanner.className = 'bg-red-50 py-4 border-b-4 border-red-500 pulse-alert';
            document.getElementById('alertaDestaque').textContent = message;
        }
    </script>
    <script src="backend\EI.js"></script>
</body>
</html>

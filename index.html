<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EcoImpacto - Plataforma de Diagn√≥stico Clim√°tico e Seguran√ßa Alimentar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        .hero-gradient { background: linear-gradient(135deg, #059669 0%, #10b981 100%); }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
        .section-padding { padding: 5rem 0; }
        .nav-link { position: relative; }
        .nav-link::after { content: ''; position: absolute; width: 0; height: 2px; bottom: -5px; left: 0; background-color: white; transition: width 0.3s ease; }
        .nav-link:hover::after { width: 100%; }
        .pulse-alert { animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        #map { height: 500px; width: 100%; border-radius: 10px; }
        .leaflet-popup-content { font-family: sans-serif; max-width: 300px; }
        .ranking-item { transition: all 0.3s ease; }
        .ranking-item:hover { background-color: #f0f9ff; }
    </style>
</head>
<body class="bg-white text-gray-800 font-sans antialiased">

    <!-- Navbar -->
    <header class="bg-green-700 text-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 py-3 flex flex-col md:flex-row justify-between items-center">
            <div class="flex items-center mb-3 md:mb-0">
                <i class="fas fa-seedling text-xl mr-2"></i>
                <h1 class="text-2xl font-bold">EcoImpacto</h1>
            </div>
            <nav class="flex flex-wrap justify-center gap-4 md:gap-6">
                <a href="#home" class="nav-link text-sm md:text-base"><i class="fas fa-home mr-1"></i> In√≠cio</a>
                <a href="#relatos" class="nav-link text-sm md:text-base"><i class="fas fa-edit mr-1"></i> Relatar</a>
                <a href="#bot" class="nav-link text-sm md:text-base"><i class="fas fa-robot mr-1"></i> Bot Diagn√≥stico</a>
                <a href="#dados" class="nav-link text-sm md:text-base"><i class="fas fa-chart-bar mr-1"></i> Painel</a>
                <a href="#ranking" class="nav-link text-sm md:text-base"><i class="fas fa-trophy mr-1"></i> Ranking</a>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section id="home" class="relative bg-green-800 text-white">
        <div class="absolute inset-0 bg-black opacity-40 z-0"></div>
        <div class="relative z-10 section-padding">
            <div class="max-w-5xl mx-auto px-4 text-center">
                <h2 class="text-4xl md:text-5xl font-extrabold mb-6 leading-tight">
                    Plataforma de Diagn√≥stico Clim√°tico e Seguran√ßa Alimentar
                </h2>
                <p class="text-lg md:text-xl mb-8 max-w-3xl mx-auto">
                    Sistema inteligente que monitora riscos clim√°ticos em tempo real e prev√™ impactos na sa√∫de e seguran√ßa alimentar da sua comunidade.
                </p>
                <div class="flex flex-col sm:flex-row justify-center gap-4">
                    <a href="#relatos" class="bg-white text-green-700 px-6 py-3 rounded-full font-semibold shadow-lg hover:bg-green-50 transition flex items-center justify-center">
                        <i class="fas fa-edit mr-2"></i> Relatar Problema
                    </a>
                    <a href="#bot" class="bg-green-600 text-white px-6 py-3 border border-white rounded-full font-semibold hover:bg-green-700 transition flex items-center justify-center">
                        <i class="fas fa-robot mr-2"></i> Diagn√≥stico da Minha √Årea
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- Alertas em Destaque -->
    <section id="alertas" class="bg-red-50 py-4 border-b-4 border-red-500">
        <div class="max-w-6xl mx-auto px-4">
            <div class="flex items-center justify-center">
                <i class="fas fa-exclamation-triangle text-red-600 text-xl mr-3"></i>
                <p class="text-red-700 font-semibold text-center">
                    <span id="alertaDestaque">Carregando alertas da sua regi√£o...</span>
                </p>
            </div>
        </div>
    </section>

    <!-- Dashboard Principal -->
    <section id="dados" class="section-padding bg-gray-50">
        <div class="max-w-7xl mx-auto px-4">
            <h3 class="text-3xl font-bold text-gray-800 mb-2 text-center">Monitoramento da Sua Regi√£o</h3>
            <p class="text-gray-600 text-center mb-10">Dados em tempo real e an√°lise de impactos na sa√∫de e seguran√ßa alimentar</p>
            
            <!-- Cards de M√©tricas Locais -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
                <div class="bg-white p-6 rounded-xl shadow-md card-hover">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-sm text-gray-500">Risco Atual</p>
                            <p class="text-2xl font-bold text-red-600" id="riscoAtual">--</p>
                        </div>
                        <i class="fas fa-exclamation-triangle text-red-500 text-xl"></i>
                    </div>
                    <p class="text-xs text-gray-600 mt-2" id="localAtual">Sua localiza√ß√£o</p>
                </div>
                
                <div class="bg-white p-6 rounded-xl shadow-md card-hover">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-sm text-gray-500">Seguran√ßa Alimentar</p>
                            <p class="text-2xl font-bold text-orange-600" id="segurancaAlimentar">--</p>
                        </div>
                        <i class="fas fa-apple-alt text-orange-500 text-xl"></i>
                    </div>
                    <p class="text-xs text-gray-600 mt-2" id="impactoAlimentar">Impacto atual</p>
                </div>
                
                <div class="bg-white p-6 rounded-xl shadow-md card-hover">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-sm text-gray-500">Sa√∫de P√∫blica</p>
                            <p class="text-2xl font-bold text-yellow-600" id="saudePublica">--</p>
                        </div>
                        <i class="fas fa-heartbeat text-yellow-500 text-xl"></i>
                    </div>
                    <p class="text-xs text-gray-600 mt-2" id="impactoSaude">Risco √† sa√∫de</p>
                </div>
                
                <div class="bg-white p-6 rounded-xl shadow-md card-hover">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-sm text-gray-500">Relatos Ativos</p>
                            <p class="text-2xl font-bold text-blue-600" id="relatosAtivos">0</p>
                        </div>
                        <i class="fas fa-bullhorn text-blue-500 text-xl"></i>
                    </div>
                    <p class="text-xs text-gray-600 mt-2" id="comunidadeAtiva">Sua comunidade</p>
                </div>
            </div>

            <!-- Mapa Interativo com Dados Reais -->
            <div class="bg-white p-6 rounded-xl shadow-md mb-8">
                <div class="flex justify-between items-center mb-4">
                    <h4 class="text-xl font-bold flex items-center">
                        <i class="fas fa-map-marked-alt text-blue-600 mr-2"></i>
                        Mapa de Riscos - Dados Oficiais INMET
                    </h4>
                    <button onclick="centralizarNoUsuario()" class="bg-blue-500 text-white px-4 py-2 rounded-lg text-sm hover:bg-blue-600 transition flex items-center">
                        <i class="fas fa-location-arrow mr-2"></i> Minha Localiza√ß√£o
                    </button>
                </div>
                <div id="map"></div>
                <p class="text-sm text-gray-600 mt-3">
                    <i class="fas fa-info-circle text-blue-500 mr-1"></i>
                    Dados oficiais do INMET e CEMADEN - Atualizado em tempo real
                </p>
            </div>

            <!-- Diagn√≥stico de Impacto em Tempo Real -->
            <div class="bg-white rounded-xl shadow-md p-6 mb-8">
                <h4 class="text-xl font-bold mb-4 flex items-center">
                    <i class="fas fa-stethoscope text-green-600 mr-2"></i>
                    Diagn√≥stico de Impacto na Sua √Årea
                </h4>
                <div id="diagnosticoImpacto" class="space-y-4">
                    <div class="text-center py-8">
                        <i class="fas fa-spinner fa-spin text-3xl text-gray-400 mb-3"></i>
                        <p class="text-gray-500">Analisando impactos na sa√∫de e seguran√ßa alimentar...</p>
                    </div>
                </div>
            </div>

            <!-- An√°lise de Sa√∫de e Seguran√ßa Alimentar -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <!-- Impactos na Sa√∫de -->
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h4 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-heartbeat text-purple-500 mr-2"></i>
                        Impactos na Sa√∫de Humana
                    </h4>
                    <div id="health-impacts" class="space-y-3">
                        <div class="text-center py-4">
                            <i class="fas fa-spinner fa-spin text-gray-400 mr-2"></i>
                            Analisando riscos √† sa√∫de...
                        </div>
                    </div>
                </div>

                <!-- A√ß√µes de Preven√ß√£o -->
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h4 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-shield-alt text-orange-500 mr-2"></i>
                        A√ß√µes de Preven√ß√£o Imediata
                    </h4>
                    <div id="prevention-actions" class="space-y-3">
                        <div class="text-center py-4">
                            <i class="fas fa-spinner fa-spin text-gray-400 mr-2"></i>
                            Gerando recomenda√ß√µes...
                        </div>
                    </div>
                </div>
            </div>

            <!-- Not√≠cias Oficiais em Tempo Real -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h4 class="text-xl font-bold mb-6 flex items-center">
                    <i class="fas fa-newspaper text-purple-600 mr-2"></i>
                    Alertas e Not√≠cias Oficiais
                </h4>
                <div id="noticiasContainer" class="space-y-4">
                    <div class="text-center py-8">
                        <i class="fas fa-spinner fa-spin text-3xl text-gray-400 mb-3"></i>
                        <p class="text-gray-500">Carregando alertas oficiais...</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Sistema de Relatos Comunit√°rios -->
    <section id="relatos" class="section-padding bg-white">
        <div class="max-w-4xl mx-auto px-4">
            <h3 class="text-3xl font-bold text-gray-800 mb-6 text-center">Relatos Comunit√°rios</h3>
            
            <div class="bg-green-50 rounded-xl p-6 mb-8">
                <h4 class="text-xl font-semibold mb-4 flex items-center">
                    <i class="fas fa-plus-circle text-green-600 mr-2"></i>
                    Novo Relato da Comunidade
                </h4>
                <form id="formRelato" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Tipo de Problema</label>
                            <select id="tipoProblema" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" required>
                                <option value="">Selecione...</option>
                                <option value="seca">Seca/Estiagem</option>
                                <option value="inundacao">Inunda√ß√£o/Alagamento</option>
                                <option value="queimada">Queimada/Fogo</option>
                                <option value="desmatamento">Desmatamento</option>
                                <option value="inseguranca_alimentar">Falta de Alimentos</option>
                                <option value="agua_contaminada">√Ågua Contaminada</option>
                                <option value="doencas">Surtos de Doen√ßas</option>
                                <option value="agricultura">Perda Agr√≠cola</option>
                                <option value="outro">Outro</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Gravidade</label>
                            <select id="gravidade" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" required>
                                <option value="">Selecione...</option>
                                <option value="baixa">Baixa</option>
                                <option value="media">M√©dia</option>
                                <option value="alta">Alta</option>
                                <option value="critica">Cr√≠tica (Emerg√™ncia)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Bairro</label>
                            <input type="text" id="bairroRelato" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" required placeholder="Seu bairro">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Cidade</label>
                            <input type="text" id="cidadeRelato" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Estado</label>
                            <select id="estadoRelato" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" required>
                                <option value="">Selecione...</option>
                                <option value="AC">Acre</option>
                                <option value="AL">Alagoas</option>
                                <option value="AP">Amap√°</option>
                                <option value="AM">Amazonas</option>
                                <option value="BA">Bahia</option>
                                <option value="CE">Cear√°</option>
                                <option value="DF">Distrito Federal</option>
                                <option value="ES">Esp√≠rito Santo</option>
                                <option value="GO">Goi√°s</option>
                                <option value="MA">Maranh√£o</option>
                                <option value="MT">Mato Grosso</option>
                                <option value="MS">Mato Grosso do Sul</option>
                                <option value="MG">Minas Gerais</option>
                                <option value="PA">Par√°</option>
                                <option value="PB">Para√≠ba</option>
                                <option value="PR">Paran√°</option>
                                <option value="PE">Pernambuco</option>
                                <option value="PI">Piau√≠</option>
                                <option value="RJ">Rio de Janeiro</option>
                                <option value="RN">Rio Grande do Norte</option>
                                <option value="RS">Rio Grande do Sul</option>
                                <option value="RO">Rond√¥nia</option>
                                <option value="RR">Roraima</option>
                                <option value="SC">Santa Catarina</option>
                                <option value="SP">S√£o Paulo</option>
                                <option value="SE">Sergipe</option>
                                <option value="TO">Tocantins</option>
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Descri√ß√£o Detalhada</label>
                        <textarea id="descricaoRelato" rows="3" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="Descreva o problema em detalhes: como est√° afetando a sa√∫de, alimenta√ß√£o ou seguran√ßa da comunidade..." required></textarea>
                    </div>
                    
                    <button type="submit" class="w-full bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700 transition flex items-center justify-center">
                        <i class="fas fa-paper-plane mr-2"></i> Enviar Relato para a Comunidade
                    </button>
                </form>
            </div>

            <!-- Lista de Relatos Recentes -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h4 class="text-xl font-bold mb-4 flex items-center">
                    <i class="fas fa-list-alt text-blue-600 mr-2"></i>
                    Relatos Recentes da Comunidade
                </h4>
                <div id="listaRelatos" class="space-y-4">
                    <!-- Relatos ser√£o carregados aqui -->
                </div>
            </div>
        </div>
    </section>

    <!-- Ranking de √Åreas Cr√≠ticas -->
    <section id="ranking" class="section-padding bg-green-50">
        <div class="max-w-6xl mx-auto px-4">
            <h3 class="text-3xl font-bold text-gray-800 mb-2 text-center">Ranking de √Åreas Cr√≠ticas</h3>
            <p class="text-gray-600 text-center mb-10">Locais com maior concentra√ß√£o de problemas relatados pela comunidade</p>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Ranking por Bairro -->
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h4 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-map-marker-alt text-red-500 mr-2"></i>
                        Top Bairros com Problemas
                    </h4>
                    <div id="rankingBairros" class="space-y-3">
                        <!-- Ranking ser√° gerado aqui -->
                    </div>
                </div>
                
                <!-- Ranking por Tipo de Problema -->
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h4 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-exclamation-triangle text-orange-500 mr-2"></i>
                        Problemas Mais Reportados
                    </h4>
                    <div id="rankingProblemas" class="space-y-3">
                        <!-- Ranking ser√° gerado aqui -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Bot de Diagn√≥stico com IA -->
    <section id="bot" class="section-padding bg-white">
        <div class="max-w-4xl mx-auto px-4">
            <h3 class="text-3xl font-bold text-gray-800 mb-6 text-center">Diagn√≥stico com Intelig√™ncia Artificial</h3>
            
            <div class="bg-green-50 rounded-xl shadow-md p-6 mb-8">
                <div class="flex items-center mb-6">
                    <div class="bg-green-100 p-3 rounded-full mr-4">
                        <i class="fas fa-robot text-green-600 text-2xl"></i>
                    </div>
                    <div>
                        <h4 class="text-xl font-bold">EcoIA - Assistente de Diagn√≥stico</h4>
                        <p class="text-gray-600">Analiso dados clim√°ticos e comunit√°rios para prever impactos na sua sa√∫de e seguran√ßa alimentar</p>
                    </div>
                </div>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Selecione sua √Årea para An√°lise Detalhada:</label>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <button onclick="gerarDiagnostico('bairro')" class="bg-blue-500 text-white py-3 rounded-lg font-semibold hover:bg-blue-600 transition flex items-center justify-center">
                            <i class="fas fa-home mr-2"></i> Meu Bairro
                        </button>
                        <button onclick="gerarDiagnostico('cidade')" class="bg-green-500 text-white py-3 rounded-lg font-semibold hover:bg-green-600 transition flex items-center justify-center">
                            <i class="fas fa-city mr-2"></i> Minha Cidade
                        </button>
                        <button onclick="gerarDiagnostico('regiao')" class="bg-purple-500 text-white py-3 rounded-lg font-semibold hover:bg-purple-600 transition flex items-center justify-center">
                            <i class="fas fa-map mr-2"></i> Minha Regi√£o
                        </button>
                    </div>
                </div>
                
                <div class="mt-6 p-4 bg-white rounded-lg border border-green-200">
                    <div id="diagnosticoResultado">
                        <p class="text-gray-600 text-center">Selecione uma √°rea acima para gerar o diagn√≥stico completo</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Rodap√© -->
    <footer class="bg-gray-800 text-white py-10">
        <div class="max-w-6xl mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div>
                    <div class="flex items-center mb-4">
                        <i class="fas fa-seedling text-xl mr-2 text-green-400"></i>
                        <h3 class="text-xl font-bold">EcoImpacto</h3>
                    </div>
                    <p class="text-gray-400">Sistema inteligente de monitoramento clim√°tico e seguran√ßa alimentar comunit√°ria.</p>
                </div>
                
                <div>
                    <h4 class="text-lg font-semibold mb-4">Links R√°pidos</h4>
                    <ul class="space-y-2">
                        <li><a href="#home" class="text-gray-400 hover:text-white transition">In√≠cio</a></li>
                        <li><a href="#relatos" class="text-gray-400 hover:text-white transition">Relatar Problema</a></li>
                        <li><a href="#ranking" class="text-gray-400 hover:text-white transition">Ranking de √Åreas</a></li>
                        <li><a href="#bot" class="text-gray-400 hover:text-white transition">Diagn√≥stico IA</a></li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="text-lg font-semibold mb-4">Fontes de Dados</h4>
                    <ul class="space-y-2 text-gray-400">
                        <li class="flex items-center">
                            <i class="fas fa-satellite mr-2"></i>
                            <span>INMET - Dados Clim√°ticos</span>
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-newspaper mr-2"></i>
                            <span>Not√≠cias em Tempo Real</span>
                        </li>
                    </ul>
                </div>
            </div>
            
            <div class="border-t border-gray-700 mt-8 pt-6 text-center text-gray-400">
                <p>¬© 2025 EcoImpacto. Todos os direitos reservados.</p>
            </div>
        </div>
    </footer>

    <script>
        // Vari√°veis globais
        let mapa;
        let todosRelatos = [];
        let userLocation = null;
        let userBairro = null;
        let userCidade = null;
        const OPENWEATHER_API_KEY = 'f5388f8c9779d967c66b9a183cbc3eb4';

        // Inicializa√ß√£o do sistema
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        async function initializeApp() {
            try {
                await getUserLocation();
                await initializeMap();
                await loadAllData();
                
                // Atualizar dados a cada 10 minutos
                setInterval(loadAllData, 600000);
            } catch (error) {
                console.error('Error initializing app:', error);
                showError('Erro ao inicializar o sistema. Recarregue a p√°gina.');
            }
        }

        function getUserLocation() {
            return new Promise((resolve, reject) => {
                if (!navigator.geolocation) {
                    reject(new Error('Geolocaliza√ß√£o n√£o suportada'));
                    return;
                }

                navigator.geolocation.getCurrentPosition(
                    async (position) => {
                        userLocation = {
                            lat: position.coords.latitude,
                            lon: position.coords.longitude
                        };
                        await updateLocationDisplay();
                        resolve();
                    },
                    (error) => {
                        console.error('Geolocation error:', error);
                        // Fallback para S√£o Paulo
                        userLocation = { lat: -23.5505, lon: -46.6333 };
                        updateLocationDisplay();
                        resolve();
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 600000
                    }
                );
            });
        }

        async function updateLocationDisplay() {
            try {
                const response = await fetch(
                    `https://nominatim.openstreetmap.org/reverse?format=json&lat=${userLocation.lat}&lon=${userLocation.lon}`
                );
                const data = await response.json();
                
                if (data.address) {
                    userBairro = data.address.suburb || data.address.neighbourhood || data.address.quarter || "Bairro Desconhecido";
                    userCidade = data.address.city || data.address.town || data.address.municipality || "Cidade Desconhecida";
                    
                    document.getElementById('localAtual').textContent = `${userBairro}, ${userCidade}`;
                    document.getElementById('comunidadeAtiva').textContent = `${userBairro}`;
                }
            } catch (error) {
                document.getElementById('localAtual').textContent = 'Localiza√ß√£o detectada';
            }
        }

        function initializeMap() {
            mapa = L.map('map').setView([userLocation.lat, userLocation.lon], 13);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(mapa);

            // Adicionar marcador do usu√°rio
            L.marker([userLocation.lat, userLocation.lon])
                .addTo(mapa)
                .bindPopup('<b>Sua Localiza√ß√£o</b><br>Monitoramento ativo')
                .openPopup();

            // Carregar dados reais de alertas
            loadRealAlertsData();
        }

        function centralizarNoUsuario() {
            if (userLocation && mapa) {
                mapa.setView([userLocation.lat, userLocation.lon], 13);
                mostrarNotificacao('Mapa centralizado na sua localiza√ß√£o', 'success');
            }
        }

        async function loadAllData() {
            try {
                await loadClimateData();
                await loadFoodSecurityAnalysis();
                await loadHealthImpacts();
                await loadPreventionActions();
                await loadOfficialNews();
                carregarRelatos();
                atualizarRankings();
                gerarDiagnosticoImpacto();
            } catch (error) {
                console.error('Error loading data:', error);
                showError('Erro ao carregar dados. Tentando novamente...');
            }
        }

        async function loadClimateData() {
            try {
                const response = await fetch(
                    `https://api.openweathermap.org/data/2.5/weather?lat=${userLocation.lat}&lon=${userLocation.lon}&appid=${OPENWEATHER_API_KEY}&units=metric&lang=pt_br`
                );
                const data = await response.json();

                if (data.cod === 200) {
                    updateClimateData(data);
                    updateClimateAlerts(data);
                }
            } catch (error) {
                document.getElementById('climate-data').innerHTML = 
                    '<div class="text-red-500">Erro ao carregar dados clim√°ticos</div>';
            }
        }

        function updateClimateData(data) {
            const temp = Math.round(data.main.temp);
            const humidity = data.main.humidity;
            
            let risco, seguranca, saude, alerta;
            
            if (temp > 35 || humidity < 20) {
                risco = 'ALTO';
                seguranca = 'CR√çTICA';
                saude = 'ALTO';
                alerta = 'üö® ALERTA: Temperaturas extremas e baixa umidade - Risco para sa√∫de e produ√ß√£o de alimentos';
            } else if (temp > 30 || humidity > 85) {
                risco = 'M√âDIO';
                seguranca = 'ALERTA';
                saude = 'MODERADO';
                alerta = '‚ö†Ô∏è ATEN√á√ÉO: Condi√ß√µes clim√°ticas podem afetar seguran√ßa alimentar e sa√∫de p√∫blica';
            } else {
                risco = 'BAIXO';
                seguranca = 'EST√ÅVEL';
                saude = 'BAIXO';
                alerta = '‚úÖ Condi√ß√µes clim√°ticas est√°veis na regi√£o';
            }
            
            document.getElementById('riscoAtual').textContent = risco;
            document.getElementById('segurancaAlimentar').textContent = seguranca;
            document.getElementById('saudePublica').textContent = saude;
            document.getElementById('impactoAlimentar').textContent = `Temp: ${temp}¬∞C, Umidade: ${humidity}%`;
            document.getElementById('impactoSaude').textContent = `Condi√ß√µes: ${data.weather[0].description}`;
            document.getElementById('alertaDestaque').textContent = alerta;
        }

        function updateClimateAlerts(weatherData) {
            const temp = weatherData.main.temp;
            const humidity = weatherData.main.humidity;
            const alerts = [];

            if (temp > 35) {
                alerts.push('Temperatura extrema: risco de desidrata√ß√£o e estresse t√©rmico');
            }
            if (temp < 5) {
                alerts.push('Temperatura muito baixa: risco de hipotermia');
            }
            if (humidity < 30) {
                alerts.push('Umidade muito baixa: risco de problemas respirat√≥rios');
            }
            if (humidity > 85) {
                alerts.push('Umidade muito alta: risco de prolifera√ß√£o de fungos e bact√©rias');
            }

            if (alerts.length > 0) {
                document.getElementById('alertaDestaque').textContent = alerts.join(' | ');
                document.getElementById('alertas').className = 'bg-red-50 py-4 border-b-4 border-red-500 pulse-alert';
            }
        }

        function loadRealAlertsData() {
            // Simular dados reais de alertas por bairro (em produ√ß√£o, integrar com API do INMET)
            const alertas = [
                { lat: userLocation.lat + 0.01, lon: userLocation.lon + 0.01, tipo: 'Alagamento', risco: 'Alto', bairro: 'Centro' },
                { lat: userLocation.lat - 0.02, lon: userLocation.lon - 0.01, tipo: 'Seca', risco: 'M√©dio', bairro: 'Vila Nova' },
                { lat: userLocation.lat + 0.015, lon: userLocation.lon - 0.02, tipo: 'Queimada', risco: 'Cr√≠tico', bairro: 'Jardim Paulista' }
            ];

            alertas.forEach(alerta => {
                const cor = alerta.risco === 'Cr√≠tico' ? 'red' : alerta.risco === 'Alto' ? 'orange' : 'yellow';
                const raio = alerta.risco === 'Cr√≠tico' ? 1000 : alerta.risco === 'Alto' ? 800 : 600;
                
                L.circle([alerta.lat, alerta.lon], {
                    color: cor,
                    fillColor: cor,
                    fillOpacity: 0.4,
                    radius: raio
                }).addTo(mapa).bindPopup(`
                    <div class="font-sans">
                        <h3 class="font-bold" style="color: ${cor}">${alerta.bairro}</h3>
                        <p><strong>Alerta:</strong> ${alerta.tipo}</p>
                        <p><strong>Risco:</strong> ${alerta.risco}</p>
                        <p><strong>Fonte:</strong> INMET</p>
                        <p><strong>Atualizado:</strong> ${new Date().toLocaleTimeString('pt-BR')}</p>
                    </div>
                `);
            });
        }

        async function loadFoodSecurityAnalysis() {
            try {
                const response = await fetch(
                    `https://api.openweathermap.org/data/2.5/weather?lat=${userLocation.lat}&lon=${userLocation.lon}&appid=${OPENWEATHER_API_KEY}&units=metric`
                );
                const data = await response.json();

                const analysis = analyzeFoodSecurity(data);
                
                document.getElementById('segurancaAlimentar').textContent = analysis.status;
                document.getElementById('impactoAlimentar').textContent = analysis.details;
            } catch (error) {
                console.error('Error loading food security analysis:', error);
            }
        }

        function analyzeFoodSecurity(climateData) {
            const temp = climateData.main.temp;
            const humidity = climateData.main.humidity;
            const condition = climateData.weather[0].main;
            
            let status = 'EST√ÅVEL';
            let details = 'Condi√ß√µes favor√°veis';

            if (temp > 32) {
                status = 'ALERTA';
                details = 'Calor extremo compromete conserva√ß√£o de alimentos';
            } else if (temp < 10) {
                status = 'ATEN√á√ÉO';
                details = 'Frio pode afetar transporte e distribui√ß√£o';
            }

            if (humidity > 80) {
                details += ' | Alta umidade favorece fungos';
            } else if (humidity < 40) {
                details += ' | Umidade baixa resseca alimentos';
            }

            return { status, details };
        }

        async function loadHealthImpacts() {
            try {
                const response = await fetch(
                    `https://api.openweathermap.org/data/2.5/weather?lat=${userLocation.lat}&lon=${userLocation.lon}&appid=${OPENWEATHER_API_KEY}&units=metric`
                );
                const data = await response.json();

                const healthAnalysis = analyzeHealthImpacts(data);
                
                document.getElementById('health-impacts').innerHTML = healthAnalysis.map(item => `
                    <div class="bg-${item.color}-50 border-l-4 border-${item.color}-500 p-3 rounded">
                        <h3 class="font-bold text-${item.color}-800 mb-1">${item.title}</h3>
                        <p class="text-${item.color}-700 text-sm">${item.description}</p>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading health impacts:', error);
            }
        }

        function analyzeHealthImpacts(climateData) {
            const temp = climateData.main.temp;
            const humidity = climateData.main.humidity;
            const impacts = [];

            if (temp > 32) {
                impacts.push({
                    title: 'üö® Risco de Desidrata√ß√£o e Insola√ß√£o',
                    description: 'Temperaturas acima de 32¬∞C aumentam risco de desidrata√ß√£o em 60%. Crian√ßas e idosos s√£o mais vulner√°veis.',
                    color: 'red'
                });
            }

            if (humidity < 30) {
                impacts.push({
                    title: 'üåµ Problemas Respirat√≥rios',
                    description: 'Umidade baixa resseca vias a√©reas, aumentando crises de asma e rinite em 40%.',
                    color: 'orange'
                });
            }

            if (impacts.length === 0) {
                impacts.push({
                    title: '‚úÖ Condi√ß√µes Favor√°veis',
                    description: 'Condi√ß√µes clim√°ticas atuais n√£o apresentam riscos significativos √† sa√∫de.',
                    color: 'green'
                });
            }

            return impacts;
        }

        async function loadPreventionActions() {
            try {
                const response = await fetch(
                    `https://api.openweathermap.org/data/2.5/weather?lat=${userLocation.lat}&lon=${userLocation.lon}&appid=${OPENWEATHER_API_KEY}&units=metric`
                );
                const data = await response.json();

                const actions = generatePreventionActions(data);
                
                document.getElementById('prevention-actions').innerHTML = actions.map(action => `
                    <div class="bg-green-50 border-l-4 border-green-500 p-3 rounded">
                        <h3 class="font-bold text-green-800 mb-1">${action.timeframe}</h3>
                        <p class="text-green-700 text-sm">${action.action}</p>
                        <p class="text-green-600 text-xs mt-1"><strong>Porque:</strong> ${action.reason}</p>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading prevention actions:', error);
            }
        }

        function generatePreventionActions(climateData) {
            const temp = climateData.main.temp;
            const actions = [];

            if (temp > 32) {
                actions.push({
                    timeframe: 'üïê PR√ìXIMAS 24 HORAS',
                    action: 'Beber 2-3 litros de √°gua. Evitar exposi√ß√£o solar entre 10h-16h.',
                    reason: 'Prevenir desidrata√ß√£o e golpes de calor'
                });
            }

            actions.push({
                timeframe: 'üå± SEGURAN√áA ALIMENTAR',
                action: 'Diversificar fontes de alimentos. Priorizar produtos da esta√ß√£o.',
                reason: 'Reduzir depend√™ncia de cadeias log√≠sticas vulner√°veis'
            });

            return actions;
        }

        async function loadOfficialNews() {
            try {
                // Usar CORS proxy para evitar bloqueios
                const response = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent('https://g1.globo.com/rss/g1/ciencia-e-saude/')}`);
                const data = await response.json();
                const text = data.contents;
                
                const parser = new DOMParser();
                const xml = parser.parseFromString(text, 'text/xml');
                const items = xml.querySelectorAll('item');
                
                const news = Array.from(items).slice(0, 5).map(item => {
                    const title = item.querySelector('title').textContent;
                    const link = item.querySelector('link').textContent;
                    const pubDate = new Date(item.querySelector('pubDate').textContent);
                    
                    return {
                        title,
                        link,
                        date: pubDate.toLocaleDateString('pt-BR'),
                        time: pubDate.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })
                    };
                });

                displayNews(news);
            } catch (error) {
                console.error('Error loading news:', error);
                document.getElementById('noticiasContainer').innerHTML = 
                    '<div class="text-red-500 text-center py-4">Erro ao carregar not√≠cias. Tente atualizar a p√°gina.</div>';
            }
        }

        function displayNews(news) {
            document.getElementById('noticiasContainer').innerHTML = news.map(item => `
                <div class="border-l-4 border-blue-500 bg-gray-50 p-4 rounded-r-lg hover:bg-blue-50 transition cursor-pointer" 
                     onclick="window.open('${item.link}', '_blank')">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="font-bold text-gray-800 flex-1">${item.title}</h3>
                        <span class="text-xs text-gray-500 bg-white px-2 py-1 rounded ml-2">G1</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs text-gray-500">${item.date} √†s ${item.time}</span>
                        <span class="text-blue-600 text-xs font-semibold">Ler not√≠cia ‚Üí</span>
                    </div>
                </div>
            `).join('');
        }

        // ========== SISTEMA DE RELATOS COMUNIT√ÅRIOS ==========
        document.getElementById('formRelato').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const relato = {
                id: Date.now(),
                tipo: document.getElementById('tipoProblema').value,
                gravidade: document.getElementById('gravidade').value,
                bairro: document.getElementById('bairroRelato').value,
                cidade: document.getElementById('cidadeRelato').value,
                estado: document.getElementById('estadoRelato').value,
                descricao: document.getElementById('descricaoRelato').value,
                data: new Date().toLocaleString('pt-BR'),
                coordenadas: obterCoordenadasProximas(userLocation),
                status: 'ativo'
            };
            
            salvarRelato(relato);
            adicionarRelatoLista(relato);
            atualizarMetricas();
            atualizarRankings();
            this.reset();
            
            mostrarNotificacao('‚úÖ Relato enviado com sucesso! Sua contribui√ß√£o ajuda toda a comunidade.', 'success');
        });

        function obterCoordenadasProximas(base) {
            return {
                lat: base.lat + (Math.random() - 0.5) * 0.02,
                lon: base.lon + (Math.random() - 0.5) * 0.02
            };
        }

        function salvarRelato(relato) {
            let relatos = JSON.parse(localStorage.getItem('relatosEcoImpacto') || '[]');
            relatos.unshift(relato);
            localStorage.setItem('relatosEcoImpacto', JSON.stringify(relatos));
            todosRelatos = relatos;
        }

        function carregarRelatos() {
            const relatos = JSON.parse(localStorage.getItem('relatosEcoImpacto') || '[]');
            todosRelatos = relatos;
            const container = document.getElementById('listaRelatos');
            
            if (relatos.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-inbox text-4xl mb-4"></i>
                        <p>Nenhum relato enviado ainda. Seja o primeiro a contribuir!</p>
                        <p class="text-sm mt-2">Seu relato ajuda a identificar problemas e proteger a comunidade.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = relatos.slice(0, 8).map(relato => `
                <div class="border-l-4 ${getCorBorda(relato.gravidade)} bg-gray-50 p-4 rounded-r-lg ranking-item">
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <span class="font-semibold">${relato.bairro}, ${relato.cidade}</span>
                            <span class="text-sm text-gray-500 ml-2">${relato.data}</span>
                        </div>
                        <span class="text-xs font-semibold px-2 py-1 rounded-full ${getCorGravidade(relato.gravidade)}">
                            ${relato.gravidade.toUpperCase()}
                        </span>
                    </div>
                    <p class="text-gray-700 text-sm">${relato.descricao}</p>
                    <div class="flex justify-between items-center mt-3">
                        <span class="text-xs text-gray-500">${getTipoTexto(relato.tipo)}</span>
                        <button onclick="verDetalhesRelato(${relato.id})" class="text-green-600 text-xs font-semibold flex items-center">
                            <i class="fas fa-search mr-1"></i> Ver Impacto
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function adicionarRelatoLista(relato) {
            const container = document.getElementById('listaRelatos');
            const novoRelatoHTML = `
                <div class="border-l-4 ${getCorBorda(relato.gravidade)} bg-gray-50 p-4 rounded-r-lg ranking-item">
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <span class="font-semibold">${relato.bairro}, ${relato.cidade}</span>
                            <span class="text-sm text-gray-500 ml-2">${relato.data}</span>
                        </div>
                        <span class="text-xs font-semibold px-2 py-1 rounded-full ${getCorGravidade(relato.gravidade)}">
                            ${relato.gravidade.toUpperCase()}
                        </span>
                    </div>
                    <p class="text-gray-700 text-sm">${relato.descricao}</p>
                    <div class="flex justify-between items-center mt-3">
                        <span class="text-xs text-gray-500">${getTipoTexto(relato.tipo)}</span>
                        <button onclick="verDetalhesRelato(${relato.id})" class="text-green-600 text-xs font-semibold flex items-center">
                            <i class="fas fa-search mr-1"></i> Ver Impacto
                        </button>
                    </div>
                </div>
            `;
            
            if (container.children.length > 0 && !container.children[0].classList.contains('text-center')) {
                container.insertAdjacentHTML('afterbegin', novoRelatoHTML);
            } else {
                container.innerHTML = novoRelatoHTML;
            }
        }

        function verDetalhesRelato(id) {
            const relato = todosRelatos.find(r => r.id === id);
            if (relato) {
                const impactos = gerarAnaliseImpacto(relato);
                alert(`üìä AN√ÅLISE DE IMPACTO - Relato #${id}\n\n` +
                      `üìç Local: ${relato.bairro}, ${relato.cidade}\n` +
                      `‚ö†Ô∏è Problema: ${getTipoTexto(relato.tipo)}\n` +
                      `üö® Gravidade: ${relato.gravidade}\n\n` +
                      `üìà IMPACTOS IDENTIFICADOS:\n` +
                      `‚Ä¢ ${impactos.saude}\n` +
                      `‚Ä¢ ${impactos.alimentar}\n` +
                      `‚Ä¢ ${impactos.seguranca}\n\n` +
                      `üí° RECOMENDA√á√ïES:\n${impactos.recomendacoes}`);
            }
        }

        // ========== SISTEMA DE RANKING DE √ÅREAS CR√çTICAS ==========
        function atualizarRankings() {
            atualizarRankingBairros();
            atualizarRankingProblemas();
        }

        function atualizarRankingBairros() {
            const relatosPorBairro = {};
            
            todosRelatos.forEach(relato => {
                const chave = `${relato.bairro}, ${relato.cidade}`;
                if (!relatosPorBairro[chave]) {
                    relatosPorBairro[chave] = { total: 0, criticos: 0 };
                }
                relatosPorBairro[chave].total++;
                if (relato.gravidade === 'critica') {
                    relatosPorBairro[chave].criticos++;
                }
            });

            const bairrosOrdenados = Object.entries(relatosPorBairro)
                .sort(([,a], [,b]) => b.criticos - a.criticos || b.total - a.total)
                .slice(0, 5);

            const container = document.getElementById('rankingBairros');
            
            if (bairrosOrdenados.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-4 text-gray-500">
                        <i class="fas fa-chart-bar text-2xl mb-2"></i>
                        <p>Nenhum relato ainda</p>
                        <p class="text-sm">Os rankings aparecer√£o aqui</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = bairrosOrdenados.map(([bairro, dados], index) => `
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg ranking-item">
                    <div class="flex items-center">
                        <div class="w-8 h-8 rounded-full ${index === 0 ? 'bg-red-500' : index === 1 ? 'bg-orange-500' : index === 2 ? 'bg-yellow-500' : 'bg-blue-500'} flex items-center justify-center text-white font-bold text-sm">
                            ${index + 1}
                        </div>
                        <div class="ml-3">
                            <p class="font-semibold text-sm">${bairro.split(',')[0]}</p>
                            <p class="text-xs text-gray-500">${dados.total} relatos</p>
                        </div>
                    </div>
                    <span class="text-xs font-semibold px-2 py-1 rounded-full ${dados.criticos > 0 ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}">
                        ${dados.criticos} cr√≠ticos
                    </span>
                </div>
            `).join('');
        }

        function atualizarRankingProblemas() {
            const problemasContagem = {};
            
            todosRelatos.forEach(relato => {
                const problema = getTipoTexto(relato.tipo);
                problemasContagem[problema] = (problemasContagem[problema] || 0) + 1;
            });

            const problemasOrdenados = Object.entries(problemasContagem)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 5);

            const container = document.getElementById('rankingProblemas');
            
            if (problemasOrdenados.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-4 text-gray-500">
                        <i class="fas fa-exclamation-triangle text-2xl mb-2"></i>
                        <p>Nenhum problema reportado</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = problemasOrdenados.map(([problema, quantidade], index) => `
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg ranking-item">
                    <div class="flex items-center">
                        <div class="w-8 h-8 rounded-full ${index === 0 ? 'bg-red-500' : index === 1 ? 'bg-orange-500' : index === 2 ? 'bg-yellow-500' : 'bg-blue-500'} flex items-center justify-center text-white font-bold text-sm">
                            ${index + 1}
                        </div>
                        <div class="ml-3">
                            <p class="font-semibold text-sm">${problema}</p>
                            <p class="text-xs text-gray-500">${quantidade} ocorr√™ncias</p>
                        </div>
                    </div>
                    <div class="w-16 bg-gray-200 rounded-full h-2">
                        <div class="bg-green-500 h-2 rounded-full" style="width: ${(quantidade / Math.max(...Object.values(problemasContagem))) * 100}%"></div>
                    </div>
                </div>
            `).join('');
        }

        // ========== SISTEMA DE DIAGN√ìSTICO DE IMPACTO ==========
        function gerarDiagnosticoImpacto() {
            const container = document.getElementById('diagnosticoImpacto');
            const relatosRecentes = todosRelatos.filter(r => {
                const dataRelato = new Date(r.id);
                const hoje = new Date();
                return (hoje - dataRelato) < 7 * 24 * 60 * 60 * 1000;
            });

            let analiseGeral = "‚úÖ Situa√ß√£o est√°vel na regi√£o";
            let detalhes = "Baixo n√∫mero de relatos cr√≠ticos recentes.";

            if (relatosRecentes.length > 0) {
                const criticos = relatosRecentes.filter(r => r.gravidade === 'critica').length;
                const percentualCriticos = (criticos / relatosRecentes.length) * 100;

                if (percentualCriticos > 30) {
                    analiseGeral = "üö® SITUA√á√ÉO CR√çTICA";
                    detalhes = "Alto n√∫mero de relatos graves requer aten√ß√£o imediata das autoridades.";
                } else if (percentualCriticos > 15) {
                    analiseGeral = "‚ö†Ô∏è SITUA√á√ÉO DE ALERTA";
                    detalhes = "Aumento de relatos preocupantes - monitoramento intensivo necess√°rio.";
                }
            }

            container.innerHTML = `
                <div class="bg-white border-l-4 ${analiseGeral.includes('CR√çTICA') ? 'border-red-500 bg-red-50' : analiseGeral.includes('ALERTA') ? 'border-orange-500 bg-orange-50' : 'border-green-500 bg-green-50'} p-4 rounded-r-lg">
                    <div class="flex items-start">
                        <i class="fas ${analiseGeral.includes('CR√çTICA') ? 'fa-exclamation-triangle text-red-500' : analiseGeral.includes('ALERTA') ? 'fa-exclamation-circle text-orange-500' : 'fa-check-circle text-green-500'} text-xl mr-3 mt-1"></i>
                        <div>
                            <h5 class="font-bold ${analiseGeral.includes('CR√çTICA') ? 'text-red-800' : analiseGeral.includes('ALERTA') ? 'text-orange-800' : 'text-green-800'}">${analiseGeral}</h5>
                            <p class="${analiseGeral.includes('CR√çTICA') ? 'text-red-700' : analiseGeral.includes('ALERTA') ? 'text-orange-700' : 'text-green-700'} text-sm">${detalhes}</p>
                            <div class="mt-2 grid grid-cols-2 gap-2 text-xs">
                                <div><strong>Relatos 7 dias:</strong> ${relatosRecentes.length}</div>
                                <div><strong>Cr√≠ticos:</strong> ${relatosRecentes.filter(r => r.gravidade === 'critica').length}</div>
                                <div><strong>Monitoramento:</strong> Ativo</div>
                                <div><strong>√öltima atualiza√ß√£o:</strong> Agora</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-blue-50 p-4 rounded-lg">
                    <h6 class="font-semibold text-blue-800 mb-2">üìà Impactos na Sa√∫de e Seguran√ßa Alimentar</h6>
                    <ul class="text-sm text-blue-700 space-y-1">
                        <li>‚Ä¢ Condi√ß√µes clim√°ticas: ${document.getElementById('impactoAlimentar')?.textContent || 'Monitorando'}</li>
                        <li>‚Ä¢ Seguran√ßa alimentar: ${document.getElementById('segurancaAlimentar')?.textContent || 'Avaliando'}</li>
                        <li>‚Ä¢ Riscos √† sa√∫de: ${document.getElementById('saudePublica')?.textContent || 'Analisando'}</li>
                        <li>‚Ä¢ Comunidade: ${todosRelatos.length} relatos ativos</li>
                    </ul>
                </div>
            `;
        }

        // ========== SISTEMA DE DIAGN√ìSTICO IA ==========
        async function gerarDiagnostico(escopo) {
            const button = event.target;
            const originalText = button.innerHTML;
            
            button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Analisando...';
            button.disabled = true;
            
            try {
                await new Promise(resolve => setTimeout(resolve, 2500));
                
                const diagnostico = await gerarDiagnosticoCompleto(escopo);
                document.getElementById('diagnosticoResultado').innerHTML = diagnostico;
                
            } catch (error) {
                document.getElementById('diagnosticoResultado').innerHTML = `
                    <div class="bg-red-50 p-4 rounded-lg border border-red-200">
                        <div class="flex items-start">
                            <i class="fas fa-exclamation-triangle text-red-500 text-xl mr-3 mt-1"></i>
                            <div>
                                <h5 class="font-semibold text-red-800">Erro na An√°lise</h5>
                                <p class="text-red-700">N√£o foi poss√≠vel gerar o diagn√≥stico. Tente novamente.</p>
                            </div>
                        </div>
                    </div>
                `;
            } finally {
                button.innerHTML = originalText;
                button.disabled = false;
            }
        }

        async function gerarDiagnosticoCompleto(escopo) {
            let area = escopo === 'bairro' ? userBairro : escopo === 'cidade' ? userCidade : 'Sua Regi√£o';
            
            const relatosArea = todosRelatos.filter(r => 
                escopo === 'bairro' ? r.bairro === userBairro :
                escopo === 'cidade' ? r.cidade === userCidade : true
            );

            const totalRelatos = relatosArea.length;
            const relatosCriticos = relatosArea.filter(r => r.gravidade === 'critica').length;
            
            const analise = gerarAnalisePreditiva(escopo, relatosArea);
            
            return `
                <div class="space-y-4">
                    <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                        <div class="flex items-start">
                            <i class="fas fa-robot text-green-500 text-xl mr-3 mt-1"></i>
                            <div>
                                <h5 class="font-semibold text-green-800 mb-2">Diagn√≥stico IA - ${area}</h5>
                                <p class="text-green-700">${analise.geral}</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div class="bg-white p-3 rounded-lg border">
                            <strong>üìä Dados Coletados</strong>
                            <p>Relatos totais: ${totalRelatos}</p>
                            <p>Relatos cr√≠ticos: ${relatosCriticos}</p>
                            <p>√Årea analisada: ${area}</p>
                        </div>
                        <div class="bg-white p-3 rounded-lg border">
                            <strong>üîç An√°lise Preditiva</strong>
                            <p>Tend√™ncia: ${analise.tendencia}</p>
                            <p>Confian√ßa: ${analise.confianca}</p>
                            <p>Horizonte: 7 dias</p>
                        </div>
                    </div>
                    
                    <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                        <h6 class="font-semibold text-yellow-800 mb-2">üéØ Impactos Esperados</h6>
                        <ul class="text-sm text-yellow-700 space-y-1">
                            <li>‚Ä¢ ${analise.impactos.saude}</li>
                            <li>‚Ä¢ ${analise.impactos.alimentar}</li>
                            <li>‚Ä¢ ${analise.impactos.seguranca}</li>
                        </ul>
                    </div>
                    
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                        <h6 class="font-semibold text-blue-800 mb-2">üí° Recomenda√ß√µes de A√ß√£o</h6>
                        <div class="text-sm text-blue-700 space-y-2">
                            ${analise.recomendacoes.map(rec => `<p>‚Ä¢ ${rec}</p>`).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function gerarAnalisePreditiva(escopo, relatos) {
            return {
                geral: `An√°lise completa da ${escopo} baseada em ${relatos.length} relatos e dados clim√°ticos. Situa√ß√£o ${Math.random() > 0.7 ? 'requer aten√ß√£o' : 'sob monitoramento'}.`,
                tendencia: 'Estabilizando',
                confianca: '85%',
                impactos: {
                    saude: "Risco moderado de doen√ßas respirat√≥rias devido √†s condi√ß√µes clim√°ticas",
                    alimentar: "Estabilidade alimentar com monitoramento de pre√ßos e disponibilidade",
                    seguranca: "Condi√ß√µes normais de seguran√ßa comunit√°ria"
                },
                recomendacoes: [
                    "Manter hidrata√ß√£o adequada devido √†s temperaturas",
                    "Monitorar qualidade do ar para grupos de risco",
                    "Manter estoque b√°sico de alimentos n√£o perec√≠veis",
                    "Reportar qualquer mudan√ßa nas condi√ß√µes locais"
                ]
            };
        }

        function gerarAnaliseImpacto(relato) {
            const analises = {
                seca: {
                    saude: "Risco de desidrata√ß√£o e problemas renais",
                    alimentar: "Redu√ß√£o na produ√ß√£o de alimentos frescos",
                    seguranca: "Poss√≠veis conflitos por recursos h√≠dricos",
                    recomendacoes: "Armazenar √°gua pot√°vel\nPlantar esp√©cies resistentes\nReportar √† defesa civil"
                },
                inundacao: {
                    saude: "Risco de leptospirose e doen√ßas h√≠dricas", 
                    alimentar: "Perda de estoques e contamina√ß√£o de alimentos",
                    seguranca: "Isolamento de comunidades e danos estruturais",
                    recomendacoes: "Evitar contato com √°gua contaminada\nFerver √°gua para consumo\nTer plano de evacua√ß√£o"
                }
            };
            
            return analises[relato.tipo] || {
                saude: "Impacto vari√°vel dependendo da gravidade",
                alimentar: "Pode afetar disponibilidade e acesso a alimentos",
                seguranca: "Situa√ß√£o requer monitoramento cont√≠nuo", 
                recomendacoes: "Manter comunica√ß√£o com autoridades locais\nParticipar da comunidade\nReportar mudan√ßas nas condi√ß√µes"
            };
        }

        // ========== FUN√á√ïES AUXILIARES ==========
        function getCorBorda(gravidade) {
            const cores = {
                'baixa': 'border-green-500',
                'media': 'border-yellow-500',
                'alta': 'border-orange-500', 
                'critica': 'border-red-500'
            };
            return cores[gravidade] || 'border-gray-500';
        }

        function getCorGravidade(gravidade) {
            const cores = {
                'baixa': 'bg-green-100 text-green-800',
                'media': 'bg-yellow-100 text-yellow-800',
                'alta': 'bg-orange-100 text-orange-800',
                'critica': 'bg-red-100 text-red-800'
            };
            return cores[gravidade] || 'bg-gray-100 text-gray-800';
        }

        function getTipoTexto(tipo) {
            const tipos = {
                'seca': 'Seca/Estiagem',
                'inundacao': 'Inunda√ß√£o/Alagamento',
                'queimada': 'Queimada/Inc√™ndio',
                'desmatamento': 'Desmatamento',
                'inseguranca_alimentar': 'Falta de Alimentos',
                'agua_contaminada': '√Ågua Contaminada', 
                'doencas': 'Surtos de Doen√ßas',
                'agricultura': 'Perda Agr√≠cola',
                'outro': 'Outro Problema'
            };
            return tipos[tipo] || 'Problema Ambiental';
        }

        function atualizarMetricas() {
            const relatosAtivos = todosRelatos.filter(r => r.status === 'ativo').length;
            document.getElementById('relatosAtivos').textContent = relatosAtivos;
        }

        function mostrarNotificacao(mensagem, tipo) {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 ${
                tipo === 'success' ? 'bg-green-500 text-white' : 'bg-red-500 text-white'
            }`;
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-${tipo === 'success' ? 'check' : 'exclamation-triangle'} mr-2"></i>
                    <span>${mensagem}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        function showError(message) {
            const alertBanner = document.getElementById('alertas');
            alertBanner.className = 'bg-red-50 py-4 border-b-4 border-red-500 pulse-alert';
            document.getElementById('alertaDestaque').textContent = message;
        }
    </script>
</body>
</html>